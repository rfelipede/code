<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de C√≥digos - Produtos IoT Laager</title>
    <!-- SheetJS para trabalhar com Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- jsPDF para gerar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --laager-green-1: #99CC29;
            --laager-green-2: #B5E52E;
            --laager-green-3: #C9F233;
            --laager-blue-1: #00B1FF;
            --laager-blue-2: #A4E1FF;
            --laager-blue-3: #E6FBFF;
            --laager-dark-1: #112133;
            --laager-dark-2: #192F4C;
            --laager-dark-3: #224266;
            --laager-gray-1: #A1B7C9;
            --laager-gray-2: #BAD4E5;
            --laager-gray-3: #EDF5F7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--laager-gray-3) 0%, #ffffff 100%);
            color: var(--laager-dark-1);
            transition: all 0.3s ease;
            min-height: 100vh;
            padding: 20px;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--laager-dark-1) 0%, var(--laager-dark-2) 100%);
            color: var(--laager-gray-3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .header {
            background: var(--laager-dark-2);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--laager-green-2), var(--laager-blue-1));
        }

        h1 {
            color: var(--laager-dark-1);
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .dark-mode h1 {
            color: var(--laager-green-2);
        }

        .subtitle {
            color: var(--laager-gray-1);
            font-size: 1.1em;
        }

        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .theme-toggle, .admin-menu-btn {
            background: var(--laager-green-2);
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            color: var(--laager-dark-1);
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-menu-btn {
            background: var(--laager-blue-1);
            color: white;
        }

        .theme-toggle:hover, .admin-menu-btn:hover {
            background: var(--laager-green-3);
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .admin-menu-btn:hover {
            background: var(--laager-blue-2);
            color: var(--laager-dark-1);
        }

        /* Modal de Administra√ß√£o */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }

        .dark-mode .modal-content {
            background-color: var(--laager-dark-2);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--laager-green-2), var(--laager-blue-1));
            padding: 25px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: var(--laager-dark-1);
            font-size: 1.8em;
            margin: 0;
        }

        .close-modal {
            color: var(--laager-dark-1);
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 12px 25px;
            background: var(--laager-gray-3);
            border: 2px solid var(--laager-gray-2);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .dark-mode .admin-tab {
            background: var(--laager-dark-3);
            border-color: var(--laager-dark-1);
            color: var(--laager-gray-3);
        }

        .admin-tab.active {
            background: var(--laager-green-2);
            border-color: var(--laager-green-2);
            color: var(--laager-dark-1);
        }

        .admin-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .admin-form {
            background: var(--laager-gray-3);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .dark-mode .admin-form {
            background: var(--laager-dark-3);
        }

        .admin-form h3 {
            color: var(--laager-green-2);
            margin-bottom: 20px;
        }

        .admin-input-group {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }

        .admin-input-group label {
            font-weight: 600;
            color: var(--laager-dark-2);
            margin-bottom: 5px;
            display: block;
        }

        .dark-mode .admin-input-group label {
            color: var(--laager-green-2);
        }

        .admin-input-group input {
            padding: 12px;
            border: 2px solid var(--laager-gray-2);
            border-radius: 8px;
            font-size: 1em;
            width: 100%;
        }

        .dark-mode .admin-input-group input {
            background: var(--laager-dark-2);
            border-color: var(--laager-dark-1);
            color: var(--laager-gray-3);
        }

        .admin-add-btn {
            background: var(--laager-green-2);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--laager-dark-1);
            transition: all 0.3s ease;
        }

        .admin-add-btn:hover {
            background: var(--laager-green-3);
            transform: scale(1.05);
        }

        .product-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .product-btn {
            flex: 1;
            min-width: 200px;
            padding: 20px 30px;
            background: white;
            border: 3px solid var(--laager-gray-2);
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            color: var(--laager-dark-2);
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .product-btn {
            background: var(--laager-dark-3);
            border-color: var(--laager-dark-2);
            color: var(--laager-gray-3);
        }

        .product-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .product-btn.active {
            background: var(--laager-green-2);
            border-color: var(--laager-green-2);
            color: var(--laager-dark-1);
            transform: scale(1.05);
        }

        .dark-mode .product-btn.active {
            background: var(--laager-green-2);
            color: var(--laager-dark-1);
        }

        .form-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .dark-mode .form-container {
            background: var(--laager-dark-2);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--laager-dark-2);
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dark-mode label {
            color: var(--laager-green-2);
        }

        select {
            padding: 12px 15px;
            border: 2px solid var(--laager-gray-2);
            border-radius: 8px;
            font-size: 1em;
            background: white;
            color: var(--laager-dark-1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode select {
            background: var(--laager-dark-3);
            border-color: var(--laager-dark-1);
            color: var(--laager-gray-3);
        }

        select:focus {
            outline: none;
            border-color: var(--laager-blue-1);
            box-shadow: 0 0 0 3px rgba(0, 177, 255, 0.1);
        }

        select:hover {
            border-color: var(--laager-blue-1);
        }

        .result-container {
            background: linear-gradient(135deg, var(--laager-green-2), var(--laager-blue-1));
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            margin-top: 30px;
        }

        .result-box {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .dark-mode .result-box {
            background: var(--laager-dark-2);
        }

        .result-label {
            font-weight: 700;
            color: var(--laager-dark-2);
            margin-bottom: 10px;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .dark-mode .result-label {
            color: var(--laager-green-2);
        }

        .result-value {
            font-size: 1.3em;
            color: var(--laager-dark-1);
            font-weight: 600;
            word-wrap: break-word;
            padding: 15px;
            background: var(--laager-gray-3);
            border-radius: 8px;
            border-left: 5px solid var(--laager-green-2);
        }

        .dark-mode .result-value {
            background: var(--laager-dark-3);
            color: var(--laager-gray-3);
        }

        .copy-btn {
            background: var(--laager-blue-1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .copy-btn:hover {
            background: var(--laager-blue-2);
            color: var(--laager-dark-1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .header-controls {
                position: static;
                margin-top: 20px;
                justify-content: center;
                flex-wrap: wrap;
            }

            .theme-toggle, .admin-menu-btn {
                width: 100%;
            }

            .product-selector {
                flex-direction: column;
            }

            .product-btn {
                min-width: 100%;
            }

            .form-container {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .admin-input-group {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
        }

        .info-banner {
            background: var(--laager-blue-3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid var(--laager-blue-1);
        }

        .dark-mode .info-banner {
            background: var(--laager-dark-3);
            border-left-color: var(--laager-blue-1);
        }

        .info-banner p {
            margin: 0;
            color: var(--laager-dark-2);
            line-height: 1.6;
        }

        .dark-mode .info-banner p {
            color: var(--laager-gray-3);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section.active {
            animation: fadeIn 0.5s ease;
        }

        .export-import-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--laager-blue-3);
            border-radius: 10px;
        }

        .dark-mode .export-import-section {
            background: var(--laager-dark-3);
        }

        .export-import-section h3 {
            color: var(--laager-dark-2);
            margin-bottom: 15px;
        }

        .dark-mode .export-import-section h3 {
            color: var(--laager-green-2);
        }

        .export-import-btns {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .export-btn, .import-btn {
            background: var(--laager-blue-1);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn:hover, .import-btn:hover {
            background: var(--laager-blue-2);
            color: var(--laager-dark-1);
            transform: scale(1.05);
        }

        #importFile {
            display: none;
        }

        /* Sec√ß√£o de Instru√ß√µes */
        .instrucoes-content {
            background: white;
        }

        .dark-mode .instrucoes-content {
            background: var(--laager-dark-3) !important;
            color: var(--laager-gray-3);
        }

        .dark-mode .instrucoes-content h3 {
            color: var(--laager-green-2) !important;
        }

        .dark-mode .instrucoes-content p,
        .dark-mode .instrucoes-content li {
            color: var(--laager-gray-3);
        }

        /* Rodap√© fixo com c√≥digo e descri√ß√£o */
        .footer-display {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--laager-green-2), var(--laager-blue-1));
            padding: 20px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.2);
            z-index: 999;
            transition: all 0.3s ease;
        }

        .dark-mode .footer-display {
            background: linear-gradient(135deg, var(--laager-dark-2), var(--laager-dark-3));
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 20px;
            align-items: center;
        }

        .footer-field {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .footer-field {
            background: var(--laager-dark-1);
        }

        .footer-field label {
            display: block;
            font-size: 0.9em;
            font-weight: 600;
            color: var(--laager-dark-2);
            margin-bottom: 5px;
        }

        .dark-mode .footer-field label {
            color: var(--laager-green-2);
        }

        .footer-field-value {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--laager-blue-1);
            word-break: break-all;
        }

        .dark-mode .footer-field-value {
            color: var(--laager-blue-2);
        }

        .footer-export-btns {
            display: flex;
            gap: 10px;
        }

        .footer-export-btn {
            background: white;
            color: var(--laager-dark-1);
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .footer-export-btn:hover {
            background: var(--laager-dark-1);
            color: white;
            transform: scale(1.05);
        }

        .dark-mode .footer-export-btn {
            background: var(--laager-green-2);
            color: var(--laager-dark-1);
            border-color: var(--laager-green-2);
        }

        .dark-mode .footer-export-btn:hover {
            background: white;
            color: var(--laager-dark-1);
        }

        /* Ajustar padding do body para n√£o sobrepor o rodap√© */
        body {
            padding-bottom: 140px;
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .footer-export-btns {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()" id="theme-toggle-btn" title="Alternar Tema">‚òÄÔ∏è</button>
                <button class="admin-menu-btn" onclick="openAdminModal()" title="Painel de Administra√ß√£o">‚öôÔ∏è</button>
            </div>
            <h1>Gerador de C√≥digos Laager</h1>
            <p class="subtitle">Sistema de Nomenclatura Padronizada para Produtos IoT</p>
        </div>

        <div id="warning-banner" class="info-banner" style="background: linear-gradient(135deg, #ff6b6b, #ff8e53); border-left: 5px solid #c92a2a;">
            <p><strong>‚ö†Ô∏è ATEN√á√ÉO:</strong> Esta vers√£o n√£o possui dados pr√©-carregados. √â necess√°rio <strong>importar a planilha template Excel</strong> atrav√©s do Painel de Administra√ß√£o (‚öôÔ∏è) para popular os campos e come√ßar a gerar c√≥digos.</p>
        </div>

        <div class="product-selector">
            <button class="product-btn active" onclick="selectProduct('medidores')">
                üíß Medidores
            </button>
            <button class="product-btn" onclick="selectProduct('telemetria')">
                üì° Dispositivos RF (IoT)
            </button>
            <button class="product-btn" onclick="selectProduct('sensores')">
                üîå Sensores de Pulso
            </button>
        </div>

        <div class="form-container">
            <!-- FORMUL√ÅRIO MEDIDORES -->
            <div id="form-medidores" class="form-section active">
                <h2 style="margin-bottom: 30px; color: var(--laager-green-2);">Configura√ß√£o de Medidores</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="med-tipo">Tipo de Produto</label>
                        <select id="med-tipo" onchange="updateMedidorForm(); generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-vazao-hidro">
                        <label for="med-vazao-hidro">Vaz√£o (Hidr√¥metro)</label>
                        <select id="med-vazao-hidro" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group hidden" id="group-vazao-gas">
                        <label for="med-vazao-gas">Vaz√£o (Gas√¥metro)</label>
                        <select id="med-vazao-gas" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="med-tipo-med">Tipo de Medidor</label>
                        <select id="med-tipo-med" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-equipagem-convencional">
                        <label for="med-equipagem">Tipo de Equipagem</label>
                        <select id="med-equipagem" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group hidden" id="group-equipagem-inteligente">
                        <label for="med-protocolo">Protocolo IoT</label>
                        <select id="med-protocolo" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="med-pulso">Rela√ß√£o Pulso/Litro</label>
                        <select id="med-pulso" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="med-marca">Marca</label>
                        <select id="med-marca" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="med-aplicacao">√Årea de Aplica√ß√£o</label>
                        <select id="med-aplicacao" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- FORMUL√ÅRIO TELEMETRIA -->
            <div id="form-telemetria" class="form-section">
                <h2 style="margin-bottom: 30px; color: var(--laager-blue-1);">Configura√ß√£o de Dispositivos RF</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tel-tipo">Tipo de Produto</label>
                        <select id="tel-tipo" onchange="updateTelemetriaForm(); generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-familia">
                        <label for="tel-familia">Fam√≠lia</label>
                        <select id="tel-familia" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tel-frequencia">Frequ√™ncia</label>
                        <select id="tel-frequencia" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tel-protocolo">Protocolo</label>
                        <select id="tel-protocolo" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tel-aplicacao">Aplica√ß√£o</label>
                        <select id="tel-aplicacao" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-portas">
                        <label for="tel-portas">N√∫mero de Portas</label>
                        <select id="tel-portas" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-acessorio">
                        <label for="tel-acessorio">Tipo de Acess√≥rio/Sensor</label>
                        <select id="tel-acessorio" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-versao">
                        <label for="tel-versao">Vers√£o (Opcional)</label>
                        <select id="tel-versao" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- FORMUL√ÅRIO SENSORES -->
            <div id="form-sensores" class="form-section">
                <h2 style="margin-bottom: 30px; color: var(--laager-green-2);">Configura√ß√£o de Sensores</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="sen-tipo">Tipo de Sensor</label>
                        <select id="sen-tipo" onchange="updateSensoresForm(); generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sen-caracteristica">Caracter√≠stica</label>
                        <select id="sen-caracteristica" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sen-direcao">Dire√ß√£o do Pulso</label>
                        <select id="sen-direcao" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sen-aplicacao">Aplica√ß√£o</label>
                        <select id="sen-aplicacao" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sen-marca">Marca</label>
                        <select id="sen-marca" onchange="generateCode();">
                            <option value="">-- Selecione --</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div id="result-section" class="result-container hidden">
            <div class="result-box">
                <div class="result-label">üìù C√≥digo Gerado:</div>
                <div class="result-value" id="codigo-resultado"></div>
                <button class="copy-btn" onclick="copyToClipboard('codigo-resultado')">üìã Copiar C√≥digo</button>
            </div>
            <div class="result-box">
                <div class="result-label">üìÑ Descri√ß√£o Completa:</div>
                <div class="result-value" id="descricao-resultado"></div>
                <button class="copy-btn" onclick="copyToClipboard('descricao-resultado')">üìã Copiar Descri√ß√£o</button>
            </div>
        </div>
    </div>

    <!-- Modal de Administra√ß√£o -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Painel de Administra√ß√£o</h2>
                <button class="close-modal" onclick="closeAdminModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('medidores-admin')">Medidores</button>
                    <button class="admin-tab" onclick="switchAdminTab('telemetria-admin')">Telemetria</button>
                    <button class="admin-tab" onclick="switchAdminTab('sensores-admin')">Sensores</button>
                    <button class="admin-tab" onclick="switchAdminTab('filtros-medidores')">‚öôÔ∏è Filtros Medidores</button>
                    <button class="admin-tab" onclick="switchAdminTab('filtros-telemetria')">‚öôÔ∏è Filtros Telemetria</button>
                    <button class="admin-tab" onclick="switchAdminTab('filtros-sensores')">‚öôÔ∏è Filtros Sensores</button>
                    <button class="admin-tab" onclick="switchAdminTab('instrucoes-admin')">üìñ Instru√ß√µes de Uso</button>
                </div>

                <!-- Se√ß√£o Admin Medidores -->
                <div id="medidores-admin" class="admin-section active">
                    <div class="admin-form">
                        <h3>Adicionar Tipo de Produto (Medidor)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-med-tipo-codigo" placeholder="Ex: HD">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-med-tipo-desc" placeholder="Ex: Hidr√¥metro">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('med-tipo')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Vaz√£o (Hidr√¥metro)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-vazao-hidro-codigo" placeholder="Ex: 30">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-vazao-hidro-desc" placeholder="Ex: Qmax.3,0m¬≥">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('vazao-hidro')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Vaz√£o (Gas√¥metro)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-vazao-gas-codigo" placeholder="Ex: 25">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-vazao-gas-desc" placeholder="Ex: G2.5">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('vazao-gas')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Tipo de Medidor</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-tipo-med-codigo" placeholder="Ex: UJ">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-tipo-med-desc" placeholder="Ex: Tipo Unijato">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('tipo-med')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Equipagem</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-equipagem-codigo" placeholder="Ex: MG">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-equipagem-desc" placeholder="Ex: Pr√©-equipado para sensor Magn√©tico">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('equipagem')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Rela√ß√£o Pulso/Litro</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-pulso-codigo" placeholder="Ex: 0001">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-pulso-desc" placeholder="Ex: 1 pulso por 01 Litro">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('pulso')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Marca</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-marca-codigo" placeholder="Ex: SAG">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-marca-desc" placeholder="Ex: SAGA">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('marca')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar √Årea de Aplica√ß√£o</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-aplicacao-codigo" placeholder="Ex: AF">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-aplicacao-desc" placeholder="Ex: p/√°gua fria">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('aplicacao')">‚ûï Adicionar</button>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o Admin Telemetria -->
                <div id="telemetria-admin" class="admin-section">
                    <div class="admin-form">
                        <h3>Adicionar Tipo de Produto (Telemetria)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-tel-tipo-codigo" placeholder="Ex: MD">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-tel-tipo-desc" placeholder="Ex: M√≥dulo RF - IoT">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('tel-tipo')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Fam√≠lia</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-familia-codigo" placeholder="Ex: BB">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-familia-desc" placeholder="Ex: , fam√≠lia BUBBLE,">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('familia')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Frequ√™ncia</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-frequencia-codigo" placeholder="Ex: 28">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-frequencia-desc" placeholder="Ex: 915 a 928 MHz">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('frequencia')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Protocolo</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-protocolo-codigo" placeholder="Ex: HLS">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-protocolo-desc" placeholder="Ex: Protocolo HIBRIDO LORA/SIGFOX">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('protocolo')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Aplica√ß√£o (Telemetria)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-tel-aplicacao-codigo" placeholder="Ex: A">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-tel-aplicacao-desc" placeholder="Ex: para Hidr√¥metros">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('tel-aplicacao')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar N√∫mero de Portas</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-portas-codigo" placeholder="Ex: 1X1">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-portas-desc" placeholder="Ex: 1 Porta digital (1x1)">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('portas')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Acess√≥rio/Sensor</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-acessorio-codigo" placeholder="Ex: Z">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-acessorio-desc" placeholder="Ex: SEM SENSOR">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('acessorio')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Vers√£o</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-versao-codigo" placeholder="Ex: V1">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-versao-desc" placeholder="Ex: V.01">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('versao')">‚ûï Adicionar</button>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o Admin Sensores -->
                <div id="sensores-admin" class="admin-section">
                    <div class="admin-form">
                        <h3>Adicionar Tipo de Sensor</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-sen-tipo-codigo" placeholder="Ex: SH">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-sen-tipo-desc" placeholder="Ex: Sensor de Pulsos tipo HALL">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('sen-tipo')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Caracter√≠stica</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-caracteristica-codigo" placeholder="Ex: H">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-caracteristica-desc" placeholder="Ex: tipo HALL,">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('caracteristica')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Dire√ß√£o do Pulso</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-direcao-codigo" placeholder="Ex: 1">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-direcao-desc" placeholder="Ex: Unidirecional">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('direcao')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Aplica√ß√£o (Sensor)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-sen-aplicacao-codigo" placeholder="Ex: A">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-sen-aplicacao-desc" placeholder="Ex: para Hidr√¥metros">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('sen-aplicacao')">‚ûï Adicionar</button>
                        </div>
                    </div>

                    <div class="admin-form">
                        <h3>Adicionar Marca (Sensor)</h3>
                        <div class="admin-input-group">
                            <div>
                                <label>C√≥digo</label>
                                <input type="text" id="new-sen-marca-codigo" placeholder="Ex: SAG">
                            </div>
                            <div>
                                <label>Descri√ß√£o</label>
                                <input type="text" id="new-sen-marca-desc" placeholder="Ex: SAGA">
                            </div>
                            <button class="admin-add-btn" onclick="addOption('sen-marca')">‚ûï Adicionar</button>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Exportar/Importar -->
                
                <!-- Se√ß√£o de Configura√ß√£o de Filtros -->
                <!-- Se√ß√£o Configurar Filtros de Medidores -->
                <div id="filtros-medidores" class="admin-section">
                    <h2 style="color: var(--laager-blue-1); margin-bottom: 20px;">‚öôÔ∏è Configura√ß√£o de Filtros por Tipo de Produto</h2>
                    <p style="color: var(--laager-gray-1); margin-bottom: 25px; line-height: 1.6;">
                        Defina quais op√ß√µes devem aparecer em cada campo baseado no tipo de produto selecionado.
                        Marque as op√ß√µes que devem estar dispon√≠veis e defina valores padr√£o (auto-sele√ß√£o) quando necess√°rio.
                    </p>

                    <!-- Seletor de Tipo de Produto -->
                    <div style="margin-bottom: 30px; padding: 20px; background: var(--laager-gray-3); border-radius: 10px;">
                        <label style="display: block; font-size: 1.1em; font-weight: bold; color: var(--laager-dark-1); margin-bottom: 10px;">
                            üìã Selecione o Tipo de Produto para Configurar:
                        </label>
                        <select id="filter-tipo-produto" onchange="loadFilterConfig()" style="width: 100%; font-size: 1em; padding: 12px; border-radius: 5px; border: 2px solid var(--laager-blue-1);">
                            <option value="">-- Selecione um Tipo de Produto --</option>
                            <option value="HD">Hidr√¥metro (HD)</option>
                            <option value="GS">Gas√¥metro (GS)</option>
                            <option value="MI">Medidor Inteligente (MI)</option>
                        </select>
                    </div>

                    <!-- Container de configura√ß√£o din√¢mica -->
                    <div id="filter-config-content" style="display: none;">
                        
                        <!-- Configura√ß√£o: Tipo de Medidor -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-blue-1);">
                            <h3>üìã Tipo de Medidor</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais tipos de medidor devem aparecer para este produto:
                            </p>
                            <div id="filter-tipoMed-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tipoMed-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Tipo de Equipagem -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-green-1);">
                            <h3>üîß Tipo de Equipagem</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais tipos de equipagem devem aparecer para este produto:
                            </p>
                            <div id="filter-equipagem-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-equipagem-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Rela√ß√£o Pulso/Litro -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-blue-2);">
                            <h3>üìä Rela√ß√£o Pulso/Litro</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais rela√ß√µes pulso/litro devem aparecer para este produto:
                            </p>
                            <div id="filter-pulso-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-pulso-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Marca -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-dark-3);">
                            <h3>üè≠ Marca</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais marcas devem aparecer para este produto:
                            </p>
                            <div id="filter-marca-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-marca-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: √Årea de Aplica√ß√£o -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-green-2);">
                            <h3>üéØ √Årea de Aplica√ß√£o</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais √°reas de aplica√ß√£o devem aparecer para este produto:
                            </p>
                            <div id="filter-aplicacao-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-aplicacao-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Bot√µes de a√ß√£o -->
                        <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: center;">
                            <button onclick="saveFilterConfig()" style="padding: 15px 40px; font-size: 1.1em; background: var(--laager-green-2); color: var(--laager-dark-1); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                                üíæ Salvar Configura√ß√£o
                            </button>
                            <button onclick="resetFilterConfig()" style="padding: 15px 40px; font-size: 1.1em; background: var(--laager-gray-2); color: var(--laager-dark-1); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                                üîÑ Restaurar Padr√£o
                            </button>
                        </div>
                    </div>

                    <div id="filter-no-selection" style="text-align: center; padding: 60px 20px; color: var(--laager-gray-1);">
                        <p style="font-size: 1.2em; margin-bottom: 10px;">üëÜ Selecione um tipo de produto acima para configurar os filtros</p>
                        <p style="font-size: 0.9em;">Os filtros permitem controlar quais op√ß√µes aparecem em cada campo do formul√°rio.</p>
                    </div>
                </div>

                <!-- Se√ß√£o Configurar Filtros de Telemetria -->
                <div id="filtros-telemetria" class="admin-section">
                    <h2 style="color: var(--laager-blue-1); margin-bottom: 20px;">‚öôÔ∏è Configura√ß√£o de Filtros de Telemetria</h2>
                    <p style="color: var(--laager-gray-1); margin-bottom: 25px; line-height: 1.6;">
                        Configure os filtros para dispositivos de telemetria (M√≥dulos RF, Repetidores, Gateways e Setup Devices). 
                        Defina quais op√ß√µes aparecem em cada campo do formul√°rio de acordo com o tipo de produto selecionado.
                    </p>

                    <!-- Seletor de Tipo de Produto -->
                    <div class="admin-form" style="background: linear-gradient(135deg, var(--laager-blue-1), var(--laager-blue-2)); padding: 25px; border-radius: 10px; margin-bottom: 30px;">
                        <label style="display: block; margin-bottom: 12px; font-size: 1.1em; font-weight: bold; color: white;">
                            üì° Selecione o Tipo de Produto para Configurar:
                        </label>
                        <select id="filter-tipo-telemetria" onchange="loadFilterConfigTelemetria()" style="width: 100%; font-size: 1em; padding: 12px; border-radius: 5px; border: 2px solid var(--laager-blue-1);">
                            <option value="">-- Selecione um Tipo de Produto --</option>
                            <option value="MD">M√≥dulo RF - IoT (MD)</option>
                            <option value="RP">Repetidor de Dados (RP)</option>
                            <option value="GW">Gateway (GW)</option>
                            <option value="ST">Dispositivo de Setup - handheld (ST)</option>
                        </select>
                    </div>

                    <!-- Container de configura√ß√£o din√¢mica -->
                    <div id="filter-config-content-telemetria" style="display: none;">
                        
                        <!-- Configura√ß√£o: Fam√≠lia -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-blue-1);">
                            <h3>üìã Fam√≠lia</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais fam√≠lias devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-familia-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-familia-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Frequ√™ncia -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-green-1);">
                            <h3>üì° Frequ√™ncia</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais frequ√™ncias devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-frequencia-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-frequencia-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Protocolo -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-blue-2);">
                            <h3>üîê Protocolo</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais protocolos devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-protocolo-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-protocolo-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Aplica√ß√£o -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-green-2);">
                            <h3>üéØ Aplica√ß√£o</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais aplica√ß√µes devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-aplicacao-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-aplicacao-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: N√∫mero de Portas -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-dark-3);">
                            <h3>üîå N√∫mero de Portas</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais n√∫meros de portas devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-portas-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-portas-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Tipo de Acess√≥rio/Sensor -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-blue-1);">
                            <h3>üîß Tipo de Acess√≥rio/Sensor</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais tipos de acess√≥rio/sensor devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-acessorio-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-acessorio-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Configura√ß√£o: Vers√£o -->
                        <div class="admin-form" style="border-left: 4px solid var(--laager-green-1);">
                            <h3>üìå Vers√£o</h3>
                            <p style="color: var(--laager-gray-1); font-size: 0.9em; margin-bottom: 15px;">
                                Selecione quais vers√µes devem aparecer para este tipo de produto:
                            </p>
                            <div id="filter-tel-versao-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;"></div>
                            <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 5px; border: 2px solid var(--laager-green-2);">
                                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--laager-dark-1);">
                                    ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                                </label>
                                <select id="filter-tel-versao-default" style="width: 100%; padding: 10px; border-radius: 5px;">
                                    <option value="">Nenhum</option>
                                </select>
                            </div>
                        </div>

                        <!-- Bot√µes de a√ß√£o -->
                        <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: center;">
                            <button onclick="saveFilterConfigTelemetria()" style="padding: 15px 40px; font-size: 1.1em; background: var(--laager-green-2); color: var(--laager-dark-1); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                                üíæ Salvar Configura√ß√£o
                            </button>
                            <button onclick="resetFilterConfigTelemetria()" style="padding: 15px 40px; font-size: 1.1em; background: var(--laager-gray-2); color: var(--laager-dark-1); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
                                üîÑ Restaurar Padr√£o
                            </button>
                        </div>
                    </div>

                    <div id="filter-no-selection-telemetria" style="text-align: center; padding: 60px 20px; color: var(--laager-gray-1);">
                        <p style="font-size: 1.2em; margin-bottom: 10px;">üëÜ Selecione um tipo de produto acima para configurar os filtros</p>
                        <p style="font-size: 0.9em;">Os filtros permitem controlar quais op√ß√µes aparecem em cada campo do formul√°rio de telemetria.</p>
                    </div>
                </div>

                <!-- Se√ß√£o Configurar Filtros de Sensores -->
                <div id="filtros-sensores" class="admin-section">
                    <h2 style="color: var(--laager-blue-1); margin-bottom: 20px;">‚öôÔ∏è Configura√ß√£o de Filtros de Sensores</h2>
                    <p style="color: var(--laager-gray-1); margin-bottom: 25px; line-height: 1.6;">
                        Configure os filtros para sensores de pulso (Hall, Reed, Indutivos, de N√≠vel e de Press√£o). Defina quais op√ß√µes aparecem em cada campo do formul√°rio de acordo com o tipo de sensor selecionado.
                    </p>
                    
                    <!-- Select de Tipo de Sensor -->
                    <div style="background: linear-gradient(135deg, var(--laager-blue-1), var(--laager-green-1)); padding: 25px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <label style="display: block; color: white; font-weight: bold; font-size: 1.1em; margin-bottom: 12px;">
                            üîå SELECIONE O TIPO DE SENSOR PARA CONFIGURAR:
                        </label>
                        <select id="filter-tipo-sensor" onchange="loadFilterConfigSensores()" style="width: 100%; font-size: 1em; padding: 12px; border-radius: 5px; border: 2px solid var(--laager-blue-1);">
                            <option value="">-- Selecione um Tipo de Sensor --</option>
                            <option value="SH">Sensor de Pulsos tipo HALL (SH)</option>
                            <option value="N">Sensor de N√≠vel (N)</option>
                            <option value="P">Sensor de Press√£o (P)</option>
                        </select>
                    </div>
                    
                    <!-- Conte√∫do dos Filtros -->
                    <div id="filter-config-content-sensores" style="display: none;">
                        
                        <!-- Caracter√≠stica -->
                        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #FF6B6B; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #FF6B6B; margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="margin-right: 10px;">üîß</span> Caracter√≠stica
                            </h3>
                            <p style="color: var(--laager-gray-1); margin-bottom: 15px; font-size: 0.95em;">
                                Selecione quais caracter√≠sticas devem aparecer para este tipo de sensor:
                            </p>
                            <div id="filter-sens-caracteristica-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 20px;">
                                <!-- Op√ß√µes ser√£o carregadas dinamicamente -->
                            </div>
                            <label style="display: block; color: #FF6B6B; font-weight: bold; margin-bottom: 8px; padding: 10px; background: #FFF5F5; border-radius: 5px;">
                                ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                            </label>
                            <select id="filter-sens-caracteristica-default" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #FF6B6B; font-size: 0.95em;">
                                <option value="">Nenhum</option>
                            </select>
                        </div>
                        
                        <!-- Dire√ß√£o -->
                        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #4ECDC4; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #4ECDC4; margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="margin-right: 10px;">‚û°Ô∏è</span> Dire√ß√£o
                            </h3>
                            <p style="color: var(--laager-gray-1); margin-bottom: 15px; font-size: 0.95em;">
                                Selecione quais dire√ß√µes devem aparecer para este tipo de sensor:
                            </p>
                            <div id="filter-sens-direcao-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 20px;">
                                <!-- Op√ß√µes ser√£o carregadas dinamicamente -->
                            </div>
                            <label style="display: block; color: #4ECDC4; font-weight: bold; margin-bottom: 8px; padding: 10px; background: #E8F9F8; border-radius: 5px;">
                                ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                            </label>
                            <select id="filter-sens-direcao-default" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #4ECDC4; font-size: 0.95em;">
                                <option value="">Nenhum</option>
                            </select>
                        </div>
                        
                        <!-- Aplica√ß√£o -->
                        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #9B59B6; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #9B59B6; margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="margin-right: 10px;">üéØ</span> Aplica√ß√£o
                            </h3>
                            <p style="color: var(--laager-gray-1); margin-bottom: 15px; font-size: 0.95em;">
                                Selecione quais aplica√ß√µes devem aparecer para este tipo de sensor:
                            </p>
                            <div id="filter-sens-aplicacao-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 20px;">
                                <!-- Op√ß√µes ser√£o carregadas dinamicamente -->
                            </div>
                            <label style="display: block; color: #9B59B6; font-weight: bold; margin-bottom: 8px; padding: 10px; background: #F4ECF7; border-radius: 5px;">
                                ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                            </label>
                            <select id="filter-sens-aplicacao-default" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #9B59B6; font-size: 0.95em;">
                                <option value="">Nenhum</option>
                            </select>
                        </div>
                        
                        <!-- Marca -->
                        <div style="background: white; padding: 25px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #F39C12; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h3 style="color: #F39C12; margin-bottom: 15px; display: flex; align-items: center;">
                                <span style="margin-right: 10px;">üè∑Ô∏è</span> Marca
                            </h3>
                            <p style="color: var(--laager-gray-1); margin-bottom: 15px; font-size: 0.95em;">
                                Selecione quais marcas devem aparecer para este tipo de sensor:
                            </p>
                            <div id="filter-sens-marca-options" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; margin-bottom: 20px;">
                                <!-- Op√ß√µes ser√£o carregadas dinamicamente -->
                            </div>
                            <label style="display: block; color: #F39C12; font-weight: bold; margin-bottom: 8px; padding: 10px; background: #FEF5E7; border-radius: 5px;">
                                ‚≠ê Valor Padr√£o (Auto-sele√ß√£o):
                            </label>
                            <select id="filter-sens-marca-default" style="width: 100%; padding: 10px; border-radius: 5px; border: 2px solid #F39C12; font-size: 0.95em;">
                                <option value="">Nenhum</option>
                            </select>
                        </div>
                        
                        <!-- Bot√µes de A√ß√£o -->
                        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                            <button onclick="saveFilterConfigSensores()" style="background: var(--laager-green-1); color: var(--laager-dark-1); padding: 15px 40px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üíæ Salvar Configura√ß√£o
                            </button>
                            <button onclick="resetFilterConfigSensores()" style="background: var(--laager-gray-2); color: white; padding: 15px 40px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                üîÑ Restaurar Padr√£o
                            </button>
                        </div>
                    </div>
                    
                    <!-- Mensagem quando nenhum tipo est√° selecionado -->
                    <div id="filter-no-selection-sensores" style="text-align: center; padding: 60px 20px; color: var(--laager-gray-1);">
                        <p style="font-size: 1.3em; margin-bottom: 15px;">üëÜ Selecione um tipo de sensor acima para configurar os filtros</p>
                        <p style="font-size: 0.95em; line-height: 1.6;">
                            Os filtros permitem controlar quais op√ß√µes aparecem em cada campo do formul√°rio de sensores.
                        </p>
                    </div>
                    
                    <!-- Backup e Restaura√ß√£o -->
                    <div style="background: var(--laager-dark-2); padding: 25px; border-radius: 10px; margin-top: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <h3 style="color: var(--laager-green-1); margin-bottom: 15px; display: flex; align-items: center;">
                            <span style="margin-right: 10px;">üíæ</span> Backup e Restaura√ß√£o
                        </h3>
                        <p style="color: var(--laager-gray-1); margin-bottom: 20px; font-size: 0.95em;">
                            Exporte todas as configura√ß√µes em formato Excel (.xlsx) ou importe configura√ß√µes salvas anteriormente.
                        </p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button onclick="exportToExcel()" style="background: linear-gradient(135deg, #00B1FF, #00D4FF); color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s ease; flex: 1; min-width: 200px;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                üì• Exportar Excel
                            </button>
                            <button onclick="downloadTemplate()" style="background: linear-gradient(135deg, #00D4FF, #00FFFF); color: var(--laager-dark-1); padding: 12px 25px; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s ease; flex: 1; min-width: 200px;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                üìÑ Baixar Template Excel
                            </button>
                            <button onclick="document.getElementById('import-file').click()" style="background: linear-gradient(135deg, #99CC29, #C9F233); color: var(--laager-dark-1); padding: 12px 25px; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: all 0.3s ease; flex: 1; min-width: 200px;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                üì§ Importar Configura√ß√µes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o Instru√ß√µes de Uso -->
                <div id="instrucoes-admin" class="admin-section">
                    <h2 style="color: var(--laager-blue-1); margin-bottom: 20px;">üìñ Manual de Instru√ß√µes de Uso</h2>
                    
                    <div style="margin-bottom: 30px; text-align: center;">
                        <button onclick="downloadManual()" style="padding: 15px 40px; font-size: 1.1em; background: var(--laager-green-2); color: var(--laager-dark-1); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 3px 10px rgba(0,0,0,0.2);">
                            üì• Download Manual Completo (PDF)
                        </button>
                    </div>

                    <div class="instrucoes-content" style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-height: 500px; overflow-y: auto;">
                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üéØ Vis√£o Geral</h3>
                        <p style="margin-bottom: 20px; line-height: 1.6;">
                            O <strong>Gerador de C√≥digos de Produtos IoT Laager</strong> √© um sistema completo para criar c√≥digos padronizados e descri√ß√µes detalhadas para tr√™s categorias de produtos: Medidores, Dispositivos RF (IoT) e Sensores de Pulso.
                        </p>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üìã Como Gerar C√≥digos</h3>
                        <ol style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Selecione a <strong>categoria de produto</strong> (Medidores, Dispositivos RF ou Sensores)</li>
                            <li>Preencha todos os <strong>campos obrigat√≥rios</strong> nas listas suspensas</li>
                            <li>O <strong>c√≥digo e descri√ß√£o</strong> ser√£o gerados automaticamente no rodap√©</li>
                            <li>Use os bot√µes <strong>"Copiar"</strong> ou <strong>"Exportar CSV"</strong> para salvar o resultado</li>
                        </ol>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">‚öôÔ∏è Painel de Administra√ß√£o</h3>
                        <p style="margin-bottom: 10px; line-height: 1.6;"><strong>Adicionar Novas Siglas:</strong></p>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Acesse <strong>"‚öôÔ∏è Administra√ß√£o"</strong> no canto superior direito</li>
                            <li>Selecione a aba correspondente (Medidores, Telemetria ou Sensores)</li>
                            <li>Preencha <strong>C√≥digo</strong> e <strong>Descri√ß√£o</strong></li>
                            <li>Clique em <strong>"‚ûï Adicionar"</strong></li>
                        </ul>

                        <p style="margin-bottom: 10px; line-height: 1.6;"><strong>Configurar Filtros:</strong></p>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Acesse <strong>"‚öôÔ∏è Filtros Medidores"</strong> (ou Telemetria/Sensores)</li>
                            <li>Selecione o <strong>tipo de produto</strong> (HD, GS ou MI)</li>
                            <li><strong>Marque/desmarque</strong> as op√ß√µes que devem aparecer em cada campo</li>
                            <li>Defina <strong>valores padr√£o</strong> (auto-sele√ß√£o) se necess√°rio</li>
                            <li>Clique em <strong>"üíæ Salvar Configura√ß√£o"</strong></li>
                        </ul>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üíæ Backup e Restaura√ß√£o</h3>
                        <p style="margin-bottom: 10px; line-height: 1.6;"><strong>Exportar para Excel:</strong></p>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Clique em <strong>"üì• Exportar Excel"</strong></li>
                            <li>Um arquivo <strong>.xlsx</strong> ser√° baixado com todas as configura√ß√µes</li>
                            <li>O arquivo cont√©m abas separadas para cada categoria</li>
                        </ul>

                        <p style="margin-bottom: 10px; line-height: 1.6;"><strong>Importar do Excel:</strong></p>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Clique em <strong>"üì§ Importar Excel"</strong></li>
                            <li>Selecione um arquivo <strong>.xlsx</strong> previamente exportado</li>
                            <li>Todas as configura√ß√µes ser√£o restauradas automaticamente</li>
                        </ul>

                        <p style="margin-bottom: 10px; line-height: 1.6;"><strong>Baixar Template:</strong></p>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Clique em <strong>"üìÑ Baixar Template Excel"</strong></li>
                            <li>Um arquivo modelo ser√° baixado com instru√ß√µes</li>
                            <li>Use o template para adicionar m√∫ltiplas siglas de uma vez</li>
                        </ul>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üìä Exporta√ß√£o CSV</h3>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Ap√≥s gerar um c√≥digo, clique em <strong>"üì• Exportar CSV"</strong> no rodap√©</li>
                            <li>Um arquivo CSV ser√° baixado com o c√≥digo e descri√ß√£o</li>
                            <li>O arquivo √© compat√≠vel com Excel e Google Sheets</li>
                        </ul>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üé® Modo Claro/Escuro</h3>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>Clique em <strong>"üåì Alternar Tema"</strong> no canto superior direito</li>
                            <li>O sistema alternar√° entre modo claro e escuro</li>
                            <li>A prefer√™ncia √© salva automaticamente</li>
                        </ul>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üí° Dicas Importantes</h3>
                        <ul style="margin-bottom: 20px; padding-left: 25px; line-height: 1.8;">
                            <li>O sistema funciona <strong>completamente offline</strong> ap√≥s o primeiro carregamento</li>
                            <li>Todas as configura√ß√µes s√£o salvas no <strong>navegador</strong> automaticamente</li>
                            <li>Fa√ßa <strong>backups regulares</strong> usando a exporta√ß√£o Excel</li>
                            <li>O rodap√© mostra o c√≥digo em <strong>tempo real</strong> conforme voc√™ preenche os campos</li>
                        </ul>

                        <h3 style="color: var(--laager-blue-1); margin-bottom: 15px;">üÜò Suporte</h3>
                        <p style="margin-bottom: 20px; line-height: 1.6;">
                            Para d√∫vidas ou suporte t√©cnico, entre em contato com a equipe Laager atrav√©s do e-mail: <strong>suporte@laager.com.br</strong>
                        </p>
                    </div>
                </div>

                <div class="export-import-section">
                    <h3>üíæ Backup e Restaura√ß√£o</h3>
                    <p style="margin-bottom: 15px; color: var(--laager-gray-1);">Exporte todas as configura√ß√µes em formato Excel (.xlsx) ou importe configura√ß√µes salvas anteriormente.</p>
                    <div class="export-import-btns">
                        <button class="export-btn" onclick="exportToExcel()">üì• Exportar Excel</button>
                        <button class="export-btn" onclick="downloadTemplate()">üìÑ Baixar Template Excel</button>
                        <button class="import-btn" onclick="document.getElementById('importFile').click()">üì§ Importar Configura√ß√µes</button>
                        <input type="file" id="importFile" accept=".xlsx,.xls" onchange="importFromExcel(event)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados iniciais
        // DataStore vazio - Importar planilha Excel para popular os dados
        let dataStore = {
            medidores: {
                tipo: [],
                vazaoHidro: [],
                vazaoGas: [],
                tipoMed: [],
                equipagem: [],
                protocolo: [],
                pulso: [],
                marca: [],
                aplicacao: []
            },
            telemetria: {
                tipo: [],
                familia: [],
                frequencia: [],
                protocolo: [],
                aplicacao: [],
                portas: [],
                acessorio: [],
                versao: []
            },
            sensores: {
                tipo: [],
                caracteristica: [],
                direcao: [],
                aplicacao: [],
                marca: []
            }
        };

        let currentProduct = 'medidores';

        // Carregar dados do localStorage se existir
        function loadFromStorage() {
            const stored = localStorage.getItem('laagerCodesData');
            if (stored) {
                try {
                    dataStore = JSON.parse(stored);
                    // Ocultar banner de aviso se houver dados carregados
                    checkAndHideWarning();
                } catch (e) {
                    console.error('Erro ao carregar dados:', e);
                }
            }
        }

        // Verificar se h√° dados e ocultar o banner de aviso
        function checkAndHideWarning() {
            const warningBanner = document.getElementById('warning-banner');
            if (!warningBanner) return;
            
            // Verificar se h√° pelo menos um array com dados em qualquer categoria
            const hasData = 
                (dataStore.medidores.tipo && dataStore.medidores.tipo.length > 0) ||
                (dataStore.telemetria.tipo && dataStore.telemetria.tipo.length > 0) ||
                (dataStore.sensores.tipo && dataStore.sensores.tipo.length > 0);
            
            if (hasData) {
                warningBanner.style.display = 'none';
            } else {
                warningBanner.style.display = 'block';
            }
        }

        // Salvar dados no localStorage
        function saveToStorage() {
            localStorage.setItem('laagerCodesData', JSON.stringify(dataStore));
        }

        // Inicializar formul√°rios
        function initializeForms() {
            populateSelect('med-tipo', dataStore.medidores.tipo);
            populateSelect('med-vazao-hidro', dataStore.medidores.vazaoHidro);
            populateSelect('med-vazao-gas', dataStore.medidores.vazaoGas);
            populateSelect('med-tipo-med', dataStore.medidores.tipoMed);
            populateSelect('med-equipagem', dataStore.medidores.equipagem);
            populateSelect('med-protocolo', dataStore.medidores.equipagem.filter(e => ['HLS', 'NB', 'LW'].includes(e.codigo)));
            populateSelect('med-pulso', dataStore.medidores.pulso);
            populateSelect('med-marca', dataStore.medidores.marca);
            populateSelect('med-aplicacao', dataStore.medidores.aplicacao);

            populateSelect('tel-tipo', dataStore.telemetria.tipo);
            populateSelect('tel-familia', dataStore.telemetria.familia);
            populateSelect('tel-frequencia', dataStore.telemetria.frequencia);
            populateSelect('tel-protocolo', dataStore.telemetria.protocolo);
            populateSelect('tel-aplicacao', dataStore.telemetria.aplicacao);
            populateSelect('tel-portas', dataStore.telemetria.portas);
            populateSelect('tel-acessorio', dataStore.telemetria.acessorio);
            populateSelect('tel-versao', dataStore.telemetria.versao);

            populateSelect('sen-tipo', dataStore.sensores.tipo);
            populateSelect('sen-caracteristica', dataStore.sensores.caracteristica);
            populateSelect('sen-direcao', dataStore.sensores.direcao);
            populateSelect('sen-aplicacao', dataStore.sensores.aplicacao);
            populateSelect('sen-marca', dataStore.sensores.marca);
        }

        function populateSelect(selectId, data) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            // Manter a op√ß√£o "-- Selecione --"
            select.innerHTML = '<option value="">-- Selecione --</option>';
            
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                select.appendChild(option);
            });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            
            // Atualizar √≠cone do bot√£o
            const themeBtn = document.getElementById('theme-toggle-btn');
            if (document.body.classList.contains('dark-mode')) {
                themeBtn.textContent = 'üåô';
                themeBtn.title = 'Modo Escuro Ativo';
            } else {
                themeBtn.textContent = '‚òÄÔ∏è';
                themeBtn.title = 'Modo Claro Ativo';
            }
        }

        function selectProduct(product) {
            currentProduct = product;
            
            document.querySelectorAll('.product-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('form-' + product).classList.add('active');
            
            document.getElementById('result-section').classList.add('hidden');
        }

        function updateMedidorForm() {
            const tipo = document.getElementById('med-tipo').value;
            
            // Controlar vaz√£o
            if (tipo.startsWith('GS')) {
                document.getElementById('group-vazao-hidro').classList.add('hidden');
                document.getElementById('group-vazao-gas').classList.remove('hidden');
            } else {
                document.getElementById('group-vazao-hidro').classList.remove('hidden');
                document.getElementById('group-vazao-gas').classList.add('hidden');
            }
            
            // Controlar equipagem
            if (tipo.startsWith('MI')) {
                document.getElementById('group-equipagem-convencional').classList.add('hidden');
                document.getElementById('group-equipagem-inteligente').classList.remove('hidden');
            } else {
                document.getElementById('group-equipagem-convencional').classList.remove('hidden');
                document.getElementById('group-equipagem-inteligente').classList.add('hidden');
            }
            
            // Obter c√≥digo do tipo de produto (HD, GS, MI)
            const tipoCodigo = tipo.split('|')[0];
            const config = filterConfig[tipoCodigo];
            
            // Filtrar Tipo de Medidor baseado na configura√ß√£o
            const tipoMedSelect = document.getElementById('med-tipo-med');
            tipoMedSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let tiposPermitidos = dataStore.medidores.tipoMed;
            if (config && config.tipoMed.allowed !== null) {
                tiposPermitidos = dataStore.medidores.tipoMed.filter(t => 
                    config.tipoMed.allowed.includes(t.codigo)
                );
            }
            
            tiposPermitidos.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                tipoMedSelect.appendChild(option);
            });
            
            // Auto-selecionar valor padr√£o se configurado
            if (config && config.tipoMed.default) {
                const defaultItem = tiposPermitidos.find(t => t.codigo === config.tipoMed.default);
                if (defaultItem) {
                    tipoMedSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // Filtrar √Årea de Aplica√ß√£o baseado na configura√ß√£o
            const aplicacaoSelect = document.getElementById('med-aplicacao');
            aplicacaoSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let aplicacoesPermitidas = dataStore.medidores.aplicacao;
            if (config && config.aplicacao.allowed !== null) {
                aplicacoesPermitidas = dataStore.medidores.aplicacao.filter(a => 
                    config.aplicacao.allowed.includes(a.codigo)
                );
            }
            
            aplicacoesPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                aplicacaoSelect.appendChild(option);
            });
            
            // Auto-selecionar valor padr√£o se configurado
            if (config && config.aplicacao.default) {
                const defaultItem = aplicacoesPermitidas.find(a => a.codigo === config.aplicacao.default);
                if (defaultItem) {
                    aplicacaoSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // Filtrar Tipo de Equipagem baseado na configura√ß√£o
            const equipagemSelect = document.getElementById('med-equipagem');
            equipagemSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let equipagensPermitidas = dataStore.medidores.equipagem;
            if (config && config.equipagem.allowed !== null) {
                equipagensPermitidas = dataStore.medidores.equipagem.filter(e => 
                    config.equipagem.allowed.includes(e.codigo)
                );
            }
            
            equipagensPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                equipagemSelect.appendChild(option);
            });
            
            // Auto-selecionar valor padr√£o se configurado
            if (config && config.equipagem.default) {
                const defaultItem = equipagensPermitidas.find(e => e.codigo === config.equipagem.default);
                if (defaultItem) {
                    equipagemSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // Filtrar Rela√ß√£o Pulso/Litro baseado na configura√ß√£o
            const pulsoSelect = document.getElementById('med-pulso');
            pulsoSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let pulsosPermitidos = dataStore.medidores.pulso;
            if (config && config.pulso.allowed !== null) {
                pulsosPermitidos = dataStore.medidores.pulso.filter(p => 
                    config.pulso.allowed.includes(p.codigo)
                );
            }
            
            pulsosPermitidos.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                pulsoSelect.appendChild(option);
            });
            
            // Auto-selecionar valor padr√£o se configurado
            if (config && config.pulso.default) {
                const defaultItem = pulsosPermitidos.find(p => p.codigo === config.pulso.default);
                if (defaultItem) {
                    pulsoSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // Filtrar Marca baseado na configura√ß√£o
            const marcaSelect = document.getElementById('med-marca');
            marcaSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let marcasPermitidas = dataStore.medidores.marca;
            if (config && config.marca.allowed !== null) {
                marcasPermitidas = dataStore.medidores.marca.filter(m => 
                    config.marca.allowed.includes(m.codigo)
                );
            }
            
            marcasPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                marcaSelect.appendChild(option);
            });
            
            // Auto-selecionar valor padr√£o se configurado
            if (config && config.marca.default) {
                const defaultItem = marcasPermitidas.find(m => m.codigo === config.marca.default);
                if (defaultItem) {
                    marcaSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
        }

        function updateTelemetriaForm() {
            const tipo = document.getElementById('tel-tipo').value;
            
            if (!tipo) return;
            
            // Obter c√≥digo do tipo de produto (MD, RP, GW, ST)
            const tipoCodigo = tipo.split('|')[0];
            const config = filterConfig[tipoCodigo];
            
            // Controlar visibilidade dos campos baseado no tipo
            if (tipo.startsWith('MD')) {
                document.getElementById('group-familia').classList.remove('hidden');
                document.getElementById('group-portas').classList.remove('hidden');
                document.getElementById('group-acessorio').classList.remove('hidden');
            } else {
                document.getElementById('group-familia').classList.add('hidden');
                document.getElementById('group-portas').classList.add('hidden');
                document.getElementById('group-acessorio').classList.add('hidden');
            }
            
            // Se n√£o h√° configura√ß√£o de filtros, usar todas as op√ß√µes
            if (!config) return;
            
            // === FILTRAR FAM√çLIA ===
            const familiaSelect = document.getElementById('tel-familia');
            familiaSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let familiasPermitidas = dataStore.telemetria.familia;
            if (config.familia.allowed !== null) {
                familiasPermitidas = dataStore.telemetria.familia.filter(f => 
                    config.familia.allowed.includes(f.codigo)
                );
            }
            
            familiasPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                familiaSelect.appendChild(option);
            });
            
            if (config.familia.default) {
                const defaultItem = familiasPermitidas.find(f => f.codigo === config.familia.default);
                if (defaultItem) {
                    familiaSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR FREQU√äNCIA ===
            const frequenciaSelect = document.getElementById('tel-frequencia');
            frequenciaSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let frequenciasPermitidas = dataStore.telemetria.frequencia;
            if (config.frequencia.allowed !== null) {
                frequenciasPermitidas = dataStore.telemetria.frequencia.filter(f => 
                    config.frequencia.allowed.includes(f.codigo)
                );
            }
            
            frequenciasPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                frequenciaSelect.appendChild(option);
            });
            
            if (config.frequencia.default) {
                const defaultItem = frequenciasPermitidas.find(f => f.codigo === config.frequencia.default);
                if (defaultItem) {
                    frequenciaSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR PROTOCOLO ===
            const protocoloSelect = document.getElementById('tel-protocolo');
            protocoloSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let protocolosPermitidos = dataStore.telemetria.protocolo;
            if (config.protocolo.allowed !== null) {
                protocolosPermitidos = dataStore.telemetria.protocolo.filter(p => 
                    config.protocolo.allowed.includes(p.codigo)
                );
            }
            
            protocolosPermitidos.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                protocoloSelect.appendChild(option);
            });
            
            if (config.protocolo.default) {
                const defaultItem = protocolosPermitidos.find(p => p.codigo === config.protocolo.default);
                if (defaultItem) {
                    protocoloSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR APLICA√á√ÉO ===
            const aplicacaoSelect = document.getElementById('tel-aplicacao');
            aplicacaoSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let aplicacoesPermitidas = dataStore.telemetria.aplicacao;
            if (config.aplicacao.allowed !== null) {
                aplicacoesPermitidas = dataStore.telemetria.aplicacao.filter(a => 
                    config.aplicacao.allowed.includes(a.codigo)
                );
            }
            
            aplicacoesPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                aplicacaoSelect.appendChild(option);
            });
            
            if (config.aplicacao.default) {
                const defaultItem = aplicacoesPermitidas.find(a => a.codigo === config.aplicacao.default);
                if (defaultItem) {
                    aplicacaoSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR PORTAS ===
            const portasSelect = document.getElementById('tel-portas');
            portasSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let portasPermitidas = dataStore.telemetria.portas;
            if (config.portas.allowed !== null) {
                portasPermitidas = dataStore.telemetria.portas.filter(p => 
                    config.portas.allowed.includes(p.codigo)
                );
            }
            
            portasPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                portasSelect.appendChild(option);
            });
            
            if (config.portas.default) {
                const defaultItem = portasPermitidas.find(p => p.codigo === config.portas.default);
                if (defaultItem) {
                    portasSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR ACESS√ìRIO ===
            const acessorioSelect = document.getElementById('tel-acessorio');
            acessorioSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let acessoriosPermitidos = dataStore.telemetria.acessorio;
            if (config.acessorio.allowed !== null) {
                acessoriosPermitidos = dataStore.telemetria.acessorio.filter(a => 
                    config.acessorio.allowed.includes(a.codigo)
                );
            }
            
            acessoriosPermitidos.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                acessorioSelect.appendChild(option);
            });
            
            if (config.acessorio.default) {
                const defaultItem = acessoriosPermitidos.find(a => a.codigo === config.acessorio.default);
                if (defaultItem) {
                    acessorioSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR VERS√ÉO ===
            const versaoSelect = document.getElementById('tel-versao');
            versaoSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let versoesPermitidas = dataStore.telemetria.versao;
            if (config.versao.allowed !== null) {
                versoesPermitidas = dataStore.telemetria.versao.filter(v => 
                    config.versao.allowed.includes(v.codigo)
                );
            }
            
            versoesPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                versaoSelect.appendChild(option);
            });
            
            if (config.versao.default) {
                const defaultItem = versoesPermitidas.find(v => v.codigo === config.versao.default);
                if (defaultItem) {
                    versaoSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
        }

        function updateSensoresForm() {
            const tipo = document.getElementById('sen-tipo').value;
            
            if (!tipo) return;
            
            // Obter c√≥digo do tipo de sensor (SH, N, P)
            const tipoCodigo = tipo.split('|')[0];
            const config = filterConfig[tipoCodigo];
            
            // Se n√£o h√° configura√ß√£o de filtros, usar todas as op√ß√µes
            if (!config) return;
            
            // === FILTRAR CARACTER√çSTICA ===
            const caracteristicaSelect = document.getElementById('sen-caracteristica');
            caracteristicaSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let caracteristicasPermitidas = dataStore.sensores.caracteristica;
            if (config.caracteristica.allowed !== null) {
                caracteristicasPermitidas = dataStore.sensores.caracteristica.filter(c => 
                    config.caracteristica.allowed.includes(c.codigo)
                );
            }
            
            caracteristicasPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                caracteristicaSelect.appendChild(option);
            });
            
            if (config.caracteristica.default) {
                const defaultItem = caracteristicasPermitidas.find(c => c.codigo === config.caracteristica.default);
                if (defaultItem) {
                    caracteristicaSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR DIRE√á√ÉO ===
            const direcaoSelect = document.getElementById('sen-direcao');
            direcaoSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let direcoesPermitidas = dataStore.sensores.direcao;
            if (config.direcao.allowed !== null) {
                direcoesPermitidas = dataStore.sensores.direcao.filter(d => 
                    config.direcao.allowed.includes(d.codigo)
                );
            }
            
            direcoesPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                direcaoSelect.appendChild(option);
            });
            
            if (config.direcao.default) {
                const defaultItem = direcoesPermitidas.find(d => d.codigo === config.direcao.default);
                if (defaultItem) {
                    direcaoSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR APLICA√á√ÉO ===
            const aplicacaoSelect = document.getElementById('sen-aplicacao');
            aplicacaoSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let aplicacoesPermitidas = dataStore.sensores.aplicacao;
            if (config.aplicacao.allowed !== null) {
                aplicacoesPermitidas = dataStore.sensores.aplicacao.filter(a => 
                    config.aplicacao.allowed.includes(a.codigo)
                );
            }
            
            aplicacoesPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                aplicacaoSelect.appendChild(option);
            });
            
            if (config.aplicacao.default) {
                const defaultItem = aplicacoesPermitidas.find(a => a.codigo === config.aplicacao.default);
                if (defaultItem) {
                    aplicacaoSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
            
            // === FILTRAR MARCA ===
            const marcaSelect = document.getElementById('sen-marca');
            marcaSelect.innerHTML = '<option value="">-- Selecione --</option>';
            
            let marcasPermitidas = dataStore.sensores.marca;
            if (config.marca.allowed !== null) {
                marcasPermitidas = dataStore.sensores.marca.filter(m => 
                    config.marca.allowed.includes(m.codigo)
                );
            }
            
            marcasPermitidas.forEach(item => {
                const option = document.createElement('option');
                option.value = `${item.codigo}|${item.descricao}`;
                option.textContent = `${item.descricao} (${item.codigo})`;
                marcaSelect.appendChild(option);
            });
            
            if (config.marca.default) {
                const defaultItem = marcasPermitidas.find(m => m.codigo === config.marca.default);
                if (defaultItem) {
                    marcaSelect.value = `${defaultItem.codigo}|${defaultItem.descricao}`;
                }
            }
        }

        function generateCode() {
            let codigo = '';
            let descricao = '';
            
            if (currentProduct === 'medidores') {
                const tipo = getValue('med-tipo');
                const vazaoHidro = getValue('med-vazao-hidro');
                const vazaoGas = getValue('med-vazao-gas');
                const tipoMed = getValue('med-tipo-med');
                const equipagem = getValue('med-equipagem');
                const protocolo = getValue('med-protocolo');
                const pulso = getValue('med-pulso');
                const marca = getValue('med-marca');
                const aplicacao = getValue('med-aplicacao');
                
                // Construir c√≥digo progressivamente
                if (!tipo) {
                    // Limpar se n√£o houver tipo selecionado
                    document.getElementById('footer-codigo').textContent = '-';
                    document.getElementById('footer-descricao').textContent = '-';
                    return;
                }
                
                const vazao = tipo.startsWith('GS') ? vazaoGas : vazaoHidro;
                
                // Construir c√≥digo progressivamente
                codigo = tipo.split('|')[0];
                const tipoDesc = tipo.startsWith('HD') ? 'Hidr√¥metro' : tipo.startsWith('GS') ? 'Gas√¥metro' : 'Medidor Inteligente';
                descricao = tipoDesc;
                
                if (vazao) {
                    codigo += vazao.split('|')[0];
                    descricao += ' ' + vazao.split('|')[1];
                    
                    const vazaoCodigo = vazao.split('|')[0];
                    if (vazaoCodigo === '15' || vazaoCodigo === '16') {
                        descricao += ', DN15 (1/2")';
                    } else if (vazaoCodigo === '10') {
                        descricao += ', DN25 (1")';
                    } else if (vazaoCodigo === '20') {
                        descricao += ', DN40 (1.1/2")';
                    } else {
                        descricao += ', DN20 (3/4")';
                    }
                }
                
                if (tipoMed) {
                    codigo += tipoMed.split('|')[0];
                    descricao += ', ' + tipoMed.split('|')[1];
                }
                
                if (tipo.startsWith('MI')) {
                    if (protocolo) {
                        codigo += protocolo.split('|')[0];
                        descricao += ', ' + protocolo.split('|')[1];
                    }
                } else {
                    if (equipagem) {
                        codigo += equipagem.split('|')[0];
                        descricao += ', ' + equipagem.split('|')[1];
                    }
                }
                
                if (pulso) {
                    codigo += pulso.split('|')[0];
                    descricao += ', ' + pulso.split('|')[1];
                }
                
                if (marca) {
                    codigo += marca.split('|')[0];
                    descricao += ' - ' + marca.split('|')[1];
                }
                
                if (aplicacao) {
                    codigo += aplicacao.split('|')[0];
                    descricao += ', ' + aplicacao.split('|')[1];
                }
                
            } else if (currentProduct === 'telemetria') {
                const tipo = getValue('tel-tipo');
                const familia = getValue('tel-familia');
                const frequencia = getValue('tel-frequencia');
                const protocolo = getValue('tel-protocolo');
                const aplicacao = getValue('tel-aplicacao');
                const portas = getValue('tel-portas');
                const acessorio = getValue('tel-acessorio');
                const versao = getValue('tel-versao');
                
                // Construir c√≥digo progressivamente
                if (!tipo) {
                    document.getElementById('footer-codigo').textContent = '-';
                    document.getElementById('footer-descricao').textContent = '-';
                    return;
                }
                
                codigo = tipo.split('|')[0];
                descricao = tipo.split('|')[1];
                
                if (tipo.startsWith('MD') && familia) {
                    codigo += familia.split('|')[0];
                    descricao += familia.split('|')[1];
                }
                
                if (frequencia) {
                    codigo += frequencia.split('|')[0];
                    descricao += ', ' + frequencia.split('|')[1];
                }
                
                if (protocolo) {
                    codigo += protocolo.split('|')[0];
                    descricao += ', ' + protocolo.split('|')[1];
                }
                
                if (aplicacao) {
                    codigo += aplicacao.split('|')[0];
                    descricao += ' ' + aplicacao.split('|')[1];
                }
                
                if (tipo.startsWith('MD') && portas) {
                    codigo += portas.split('|')[0];
                    descricao += ', ' + portas.split('|')[1];
                }
                
                if (tipo.startsWith('MD') && acessorio) {
                    codigo += acessorio.split('|')[0];
                    descricao += ' ' + acessorio.split('|')[1];
                } else if (tipo.startsWith('GW') && portas) {
                    codigo += portas.split('|')[0];
                    descricao += ', ' + portas.split('|')[1];
                }
                
                if (versao) {
                    codigo += versao.split('|')[0];
                    descricao += ' - ' + versao.split('|')[1];
                }
                
            } else if (currentProduct === 'sensores') {
                const tipo = getValue('sen-tipo');
                const caracteristica = getValue('sen-caracteristica');
                const direcao = getValue('sen-direcao');
                const aplicacao = getValue('sen-aplicacao');
                const marca = getValue('sen-marca');
                
                // Construir c√≥digo progressivamente
                if (!tipo) {
                    document.getElementById('footer-codigo').textContent = '-';
                    document.getElementById('footer-descricao').textContent = '-';
                    return;
                }
                
                codigo = tipo.split('|')[0];
                descricao = tipo.split('|')[1];
                
                if (caracteristica) {
                    codigo += caracteristica.split('|')[0];
                    descricao += ' ' + caracteristica.split('|')[1];
                }
                
                if (direcao) {
                    codigo += direcao.split('|')[0];
                    descricao += ' ' + direcao.split('|')[1] + ',';
                }
                
                if (aplicacao) {
                    codigo += aplicacao.split('|')[0];
                    descricao += ' ' + aplicacao.split('|')[1] + ',';
                }
                
                if (marca) {
                    codigo += marca.split('|')[0];
                    descricao += ' ' + marca.split('|')[1];
                }
            }
            
            if (codigo && descricao) {
                document.getElementById('codigo-resultado').textContent = codigo;
                document.getElementById('descricao-resultado').textContent = descricao;
                document.getElementById('result-section').classList.remove('hidden');
                
                // Atualizar rodap√© em tempo real
                document.getElementById('footer-codigo').textContent = codigo;
                document.getElementById('footer-descricao').textContent = descricao;
            }
        }

        function getValue(id) {
            return document.getElementById(id).value;
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Copiado para a √°rea de transfer√™ncia!');
            }).catch(err => {
                console.error('Erro ao copiar:', err);
            });
        }

        // Fun√ß√µes do Modal de Administra√ß√£o
        function openAdminModal() {
            document.getElementById('adminModal').classList.add('active');
            
            // Auto-selecionar MD na aba Filtros Telemetria se estiver vazia
            const filterTipoTel = document.getElementById('filter-tipo-telemetria');
            if (filterTipoTel && !filterTipoTel.value) {
                filterTipoTel.value = 'MD';
                loadFilterConfigTelemetria();
            }
            
            // Auto-selecionar SH na aba Filtros Sensores se estiver vazia
            const filterTipoSens = document.getElementById('filter-tipo-sensor');
            if (filterTipoSens && !filterTipoSens.value) {
                filterTipoSens.value = 'SH';
                loadFilterConfigSensores();
            }
        }

        function closeAdminModal() {
            document.getElementById('adminModal').classList.remove('active');
        }

        function switchAdminTab(tabId) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        function addOption(type) {
            const codigoInput = document.getElementById(`new-${type}-codigo`);
            const descInput = document.getElementById(`new-${type}-desc`);
            
            const codigo = codigoInput.value.trim();
            const descricao = descInput.value.trim();
            
            if (!codigo || !descricao) {
                alert('‚ö†Ô∏è Por favor, preencha o c√≥digo e a descri√ß√£o!');
                return;
            }
            
            const mapping = {
                'med-tipo': {store: 'medidores', key: 'tipo', select: 'med-tipo'},
                'vazao-hidro': {store: 'medidores', key: 'vazaoHidro', select: 'med-vazao-hidro'},
                'vazao-gas': {store: 'medidores', key: 'vazaoGas', select: 'med-vazao-gas'},
                'tipo-med': {store: 'medidores', key: 'tipoMed', select: 'med-tipo-med'},
                'equipagem': {store: 'medidores', key: 'equipagem', select: 'med-equipagem'},
                'pulso': {store: 'medidores', key: 'pulso', select: 'med-pulso'},
                'marca': {store: 'medidores', key: 'marca', select: 'med-marca'},
                'aplicacao': {store: 'medidores', key: 'aplicacao', select: 'med-aplicacao'},
                'tel-tipo': {store: 'telemetria', key: 'tipo', select: 'tel-tipo'},
                'familia': {store: 'telemetria', key: 'familia', select: 'tel-familia'},
                'frequencia': {store: 'telemetria', key: 'frequencia', select: 'tel-frequencia'},
                'protocolo': {store: 'telemetria', key: 'protocolo', select: 'tel-protocolo'},
                'tel-aplicacao': {store: 'telemetria', key: 'aplicacao', select: 'tel-aplicacao'},
                'portas': {store: 'telemetria', key: 'portas', select: 'tel-portas'},
                'acessorio': {store: 'telemetria', key: 'acessorio', select: 'tel-acessorio'},
                'versao': {store: 'telemetria', key: 'versao', select: 'tel-versao'},
                'sen-tipo': {store: 'sensores', key: 'tipo', select: 'sen-tipo'},
                'caracteristica': {store: 'sensores', key: 'caracteristica', select: 'sen-caracteristica'},
                'direcao': {store: 'sensores', key: 'direcao', select: 'sen-direcao'},
                'sen-aplicacao': {store: 'sensores', key: 'aplicacao', select: 'sen-aplicacao'},
                'sen-marca': {store: 'sensores', key: 'marca', select: 'sen-marca'}
            };
            
            const map = mapping[type];
            if (!map) return;
            
            // Verificar duplicatas de c√≥digo
            const existingCode = dataStore[map.store][map.key].find(item => item.codigo === codigo);
            if (existingCode) {
                alert(`‚ùå C√≥digo Duplicado!\n\nO c√≥digo "${codigo}" j√° existe nesta categoria.\n\nDescri√ß√£o existente: "${existingCode.descricao}"\n\nPor favor, use um c√≥digo diferente.`);
                return;
            }
            
            // Verificar duplicatas de descri√ß√£o
            const existingDesc = dataStore[map.store][map.key].find(item => item.descricao.toLowerCase() === descricao.toLowerCase());
            if (existingDesc) {
                const confirmAdd = confirm(`‚ö†Ô∏è Descri√ß√£o Similar Detectada!\n\nJ√° existe uma descri√ß√£o parecida:\n"${existingDesc.descricao}" (${existingDesc.codigo})\n\nNova descri√ß√£o:\n"${descricao}" (${codigo})\n\nDeseja adicionar mesmo assim?`);
                if (!confirmAdd) {
                    return;
                }
            }
            
            // Adicionar novo item
            dataStore[map.store][map.key].push({codigo, descricao});
            
            // Atualizar select
            populateSelect(map.select, dataStore[map.store][map.key]);
            
            // Salvar no localStorage
            saveToStorage();
            
            // Limpar inputs
            codigoInput.value = '';
            descInput.value = '';
            
            alert('‚úÖ Op√ß√£o adicionada com sucesso!');
        }

        // ===== FUN√á√ïES DE EXPORTA√á√ÉO/IMPORTA√á√ÉO EXCEL =====
        
        function exportToExcel() {
            try {
                const wb = XLSX.utils.book_new();
                
                // Aba: Medidores - Tipo
                const medTipoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.tipo.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(medTipoData), 'Med-Tipo');
                
                // Aba: Medidores - Vaz√£o Hidro
                const vazaoHidroData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.vazaoHidro.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(vazaoHidroData), 'Med-Vaz√£o-Hidro');
                
                // Aba: Medidores - Vaz√£o Gas
                const vazaoGasData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.vazaoGas.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(vazaoGasData), 'Med-Vaz√£o-Gas');
                
                // Aba: Medidores - Tipo Medidor
                const tipoMedData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.tipoMed.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(tipoMedData), 'Med-TipoMedidor');
                
                // Aba: Medidores - Equipagem
                const equipagemData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.equipagem.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(equipagemData), 'Med-Equipagem');
                
                // Aba: Medidores - Pulso
                const pulsoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.pulso.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(pulsoData), 'Med-Pulso');
                
                // Aba: Medidores - Marca
                const marcaData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.marca.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(marcaData), 'Med-Marca');
                
                // Aba: Medidores - Aplica√ß√£o
                const aplicacaoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.medidores.aplicacao.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(aplicacaoData), 'Med-Aplica√ß√£o');
                
                // Aba: Telemetria - Tipo
                const telTipoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.tipo.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(telTipoData), 'Tel-Tipo');
                
                // Aba: Telemetria - Fam√≠lia
                const familiaData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.familia.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(familiaData), 'Tel-Fam√≠lia');
                
                // Aba: Telemetria - Frequ√™ncia
                const frequenciaData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.frequencia.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(frequenciaData), 'Tel-Frequ√™ncia');
                
                // Aba: Telemetria - Protocolo
                const protocoloData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.protocolo.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(protocoloData), 'Tel-Protocolo');
                
                // Aba: Telemetria - Aplica√ß√£o
                const telAplicacaoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.aplicacao.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(telAplicacaoData), 'Tel-Aplica√ß√£o');
                
                // Aba: Telemetria - Portas
                const portasData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.portas.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(portasData), 'Tel-Portas');
                
                // Aba: Telemetria - Acess√≥rio
                const acessorioData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.acessorio.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(acessorioData), 'Tel-Acess√≥rio');
                
                // Aba: Telemetria - Vers√£o
                const versaoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.telemetria.versao.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(versaoData), 'Tel-Vers√£o');
                
                // Aba: Sensores - Tipo
                const sensTipoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.sensores.tipo.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(sensTipoData), 'Sens-Tipo');
                
                // Aba: Sensores - Caracter√≠stica
                const caracteristicaData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.sensores.caracteristica.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(caracteristicaData), 'Sens-Caracter√≠stica');
                
                // Aba: Sensores - Dire√ß√£o
                const direcaoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.sensores.direcao.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(direcaoData), 'Sens-Dire√ß√£o');
                
                // Aba: Sensores - Aplica√ß√£o
                const sensAplicacaoData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.sensores.aplicacao.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(sensAplicacaoData), 'Sens-Aplica√ß√£o');
                
                // Aba: Sensores - Marca
                const sensMarcaData = [['C√≥digo', 'Descri√ß√£o'], ...dataStore.sensores.marca.map(item => [item.codigo, item.descricao])];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(sensMarcaData), 'Sens-Marca');
                
                // Salvar arquivo
                const fileName = `Laager_Configuracoes_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                alert('‚úÖ Configura√ß√µes exportadas com sucesso para Excel!');
            } catch (err) {
                alert('‚ùå Erro ao exportar: ' + err.message);
            }
        }
        
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    if (confirm('‚ö†Ô∏è Isso ir√° substituir todas as configura√ß√µes atuais. Deseja continuar?')) {
                        // Importar cada aba
                        const importSheet = (sheetName, storePath) => {
                            if (workbook.SheetNames.includes(sheetName)) {
                                const sheet = workbook.Sheets[sheetName];
                                const jsonData = XLSX.utils.sheet_to_json(sheet);
                                const formattedData = jsonData.map(row => ({
                                    codigo: String(row['C√≥digo'] || row['Codigo'] || ''),
                                    descricao: String(row['Descri√ß√£o'] || row['Descricao'] || '')
                                })).filter(item => item.codigo && item.descricao);
                                
                                // Atualizar dataStore
                                const keys = storePath.split('.');
                                let obj = dataStore;
                                for (let i = 0; i < keys.length - 1; i++) {
                                    obj = obj[keys[i]];
                                }
                                obj[keys[keys.length - 1]] = formattedData;
                            }
                        };
                        
                        // Importar todas as abas
                        importSheet('Med-Tipo', 'medidores.tipo');
                        importSheet('Med-Vaz√£o-Hidro', 'medidores.vazaoHidro');
                        importSheet('Med-Vaz√£o-Gas', 'medidores.vazaoGas');
                        importSheet('Med-TipoMedidor', 'medidores.tipoMed');
                        importSheet('Med-Equipagem', 'medidores.equipagem');
                        importSheet('Med-Pulso', 'medidores.pulso');
                        importSheet('Med-Marca', 'medidores.marca');
                        importSheet('Med-Aplica√ß√£o', 'medidores.aplicacao');
                        importSheet('Tel-Tipo', 'telemetria.tipo');
                        importSheet('Tel-Fam√≠lia', 'telemetria.familia');
                        importSheet('Tel-Frequ√™ncia', 'telemetria.frequencia');
                        importSheet('Tel-Protocolo', 'telemetria.protocolo');
                        importSheet('Tel-Aplica√ß√£o', 'telemetria.aplicacao');
                        importSheet('Tel-Portas', 'telemetria.portas');
                        importSheet('Tel-Acess√≥rio', 'telemetria.acessorio');
                        importSheet('Tel-Vers√£o', 'telemetria.versao');
                        importSheet('Sens-Tipo', 'sensores.tipo');
                        importSheet('Sens-Caracter√≠stica', 'sensores.caracteristica');
                        importSheet('Sens-Dire√ß√£o', 'sensores.direcao');
                        importSheet('Sens-Aplica√ß√£o', 'sensores.aplicacao');
                        importSheet('Sens-Marca', 'sensores.marca');
                        
                        saveToStorage();
                        initializeForms();
                        checkAndHideWarning(); // Ocultar banner de aviso ap√≥s importa√ß√£o
                        alert('‚úÖ Configura√ß√µes importadas com sucesso do Excel!');
                        closeAdminModal();
                    }
                } catch (err) {
                    alert('‚ùå Erro ao importar arquivo Excel: ' + err.message);
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Limpar input
            event.target.value = '';
        }
        
        function downloadTemplate() {
            try {
                const wb = XLSX.utils.book_new();
                
                // Criar template com instru√ß√µes
                const instrucoes = [
                    ['TEMPLATE DE CONFIGURA√á√ïES - GERADOR DE C√ìDIGOS LAAGER'],
                    [''],
                    ['INSTRU√á√ïES:'],
                    ['1. Cada aba representa uma categoria de configura√ß√£o'],
                    ['2. Preencha os campos "C√≥digo" e "Descri√ß√£o" nas linhas abaixo do cabe√ßalho'],
                    ['3. N√ÉO modifique os nomes das colunas (C√≥digo e Descri√ß√£o)'],
                    ['4. N√ÉO modifique os nomes das abas'],
                    ['5. Ap√≥s preencher, salve o arquivo e importe no sistema'],
                    [''],
                    ['EXEMPLO:'],
                    ['C√≥digo', 'Descri√ß√£o'],
                    ['HD', 'Hidr√¥metro'],
                    ['GS', 'Gas√¥metro']
                ];
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(instrucoes), 'INSTRU√á√ïES');
                
                // Templates vazios para cada categoria
                const templateData = [['C√≥digo', 'Descri√ß√£o'], ['', ''], ['', ''], ['', '']];
                
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Tipo');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Vaz√£o-Hidro');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Vaz√£o-Gas');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-TipoMedidor');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Equipagem');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Pulso');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Marca');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Med-Aplica√ß√£o');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Tipo');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Fam√≠lia');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Frequ√™ncia');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Protocolo');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Aplica√ß√£o');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Portas');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Acess√≥rio');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Tel-Vers√£o');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Sens-Tipo');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Sens-Caracter√≠stica');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Sens-Dire√ß√£o');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Sens-Aplica√ß√£o');
                XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(templateData), 'Sens-Marca');
                
                XLSX.writeFile(wb, 'Template_Laager_Configuracoes.xlsx');
                alert('‚úÖ Template Excel baixado com sucesso!');
            } catch (err) {
                alert('‚ùå Erro ao gerar template: ' + err.message);
            }
        }
        
        function downloadManual() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Cores Laager
            const laagerGreen = '#99CC29';
            const laagerBlue = '#00B1FF';
            const laagerDark = '#112133';
            const laagerGray = '#A1B7C9';

            let y = 20;

            // T√≠tulo
            doc.setFontSize(22);
            doc.setTextColor(laagerDark);
            doc.text('Manual de Instru√ß√µes', 105, y, { align: 'center' });
            y += 8;
            doc.setFontSize(16);
            doc.setTextColor(laagerBlue);
            doc.text('Gerador de C√≥digos de Produtos IoT Laager', 105, y, { align: 'center' });
            y += 15;

            // Fun√ß√£o para adicionar se√ß√µes
            const addSection = (title, content) => {
                doc.setFontSize(16);
                doc.setTextColor(laagerGreen);
                doc.text(title, 15, y);
                y += 8;
                doc.setFontSize(11);
                doc.setTextColor(laagerDark);
                doc.text(content, 20, y, { maxWidth: 170, align: 'justify' });
                y += doc.getTextDimensions(content, { maxWidth: 170 }).h + 15;
            };

            // Conte√∫do do manual
            addSection('üéØ Vis√£o Geral',
                'O Gerador de C√≥digos de Produtos IoT Laager √© um sistema completo para criar c√≥digos padronizados e descri√ß√µes detalhadas para tr√™s categorias de produtos: Medidores, Dispositivos RF (IoT) e Sensores de Pulso.'
            );

            addSection('üìã Como Gerar C√≥digos',
                '1. Selecione a categoria de produto (Medidores, Dispositivos RF ou Sensores).\n' +
                '2. Preencha todos os campos obrigat√≥rios nas listas suspensas.\n' +
                '3. O c√≥digo e descri√ß√£o ser√£o gerados automaticamente no rodap√©.\n' +
                '4. Use os bot√µes "Copiar" ou "Exportar CSV" para salvar o resultado.'
            );

            addSection('‚öôÔ∏è Painel de Administra√ß√£o',
                'Adicionar Novas Siglas:\n' +
                '- Acesse "‚öôÔ∏è Administra√ß√£o" no canto superior direito.\n' +
                '- Selecione a aba correspondente (Medidores, Telemetria ou Sensores).\n' +
                '- Preencha C√≥digo e Descri√ß√£o e clique em "‚ûï Adicionar".\n\n' +
                'Configurar Filtros:\n' +
                '- Acesse "‚öôÔ∏è Filtros Medidores" (ou Telemetria/Sensores).\n' +
                '- Selecione o tipo de produto (HD, GS ou MI).\n' +
                '- Marque/desmarque as op√ß√µes que devem aparecer em cada campo.\n' +
                '- Defina valores padr√£o (auto-sele√ß√£o) se necess√°rio.\n' +
                '- Clique em "üíæ Salvar Configura√ß√£o".'
            );

            addSection('üíæ Backup e Restaura√ß√£o',
                'Exportar para Excel:\n' +
                '- Clique em "üì• Exportar Excel" para baixar um arquivo .xlsx com todas as configura√ß√µes.\n\n' +
                'Importar do Excel:\n' +
                '- Clique em "üì§ Importar Excel" e selecione um arquivo .xlsx para restaurar as configura√ß√µes.\n\n' +
                'Baixar Template:\n' +
                '- Clique em "üìÑ Baixar Template Excel" para baixar um modelo com instru√ß√µes.'
            );

            addSection('üìä Exporta√ß√£o CSV',
                'Ap√≥s gerar um c√≥digo, clique em "üì• Exportar CSV" no rodap√© para baixar um arquivo CSV com o c√≥digo e a descri√ß√£o.'
            );

            addSection('üé® Modo Claro/Escuro',
                'Clique em "üåì Alternar Tema" no canto superior direito para alternar entre os modos de visualiza√ß√£o.'
            );

            addSection('üí° Dicas Importantes',
                '- O sistema funciona completamente offline ap√≥s o primeiro carregamento.\n' +
                '- Todas as configura√ß√µes s√£o salvas no navegador automaticamente.\n' +
                '- Fa√ßa backups regulares usando a exporta√ß√£o Excel.\n' +
                '- O rodap√© mostra o c√≥digo em tempo real conforme voc√™ preenche os campos.'
            );

            addSection('üÜò Suporte',
                'Para d√∫vidas ou suporte t√©cnico, entre em contato com a equipe Laager atrav√©s do e-mail: suporte@laager.com.br'
            );

            // Salvar o PDF
            doc.save('Manual_Gerador_Codigos_Laager.pdf');
            alert('‚úÖ Manual em PDF baixado com sucesso!');
        }

        // ===== FUN√á√ïES DE CONFIGURA√á√ÉO DE FILTROS =====
        
        // Configura√ß√£o de filtros por tipo de produto (armazenada no localStorage)
        let filterConfig = {
            HD: {  // Hidr√¥metro
                tipoMed: {
                    allowed: ['UJ', 'MJ'],  // Apenas Unijato e Multijato
                    default: null
                },
                equipagem: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                pulso: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                marca: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                aplicacao: {
                    allowed: ['AF', 'AQ'],  // Apenas √°gua fria e quente
                    default: null
                }
            },
            GS: {  // Gas√¥metro
                tipoMed: {
                    allowed: ['DF', 'VL'],  // Apenas Diafragma e Volum√©trico
                    default: 'DF'  // Auto-seleciona Diafragma
                },
                equipagem: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                pulso: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                marca: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                aplicacao: {
                    allowed: ['0'],  // Apenas G√°s Natural/GLP
                    default: '0'  // Auto-seleciona
                }
            },
            MI: {  // Medidor Inteligente
                tipoMed: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                equipagem: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                pulso: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                marca: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                aplicacao: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                }
            },
            // === FILTROS PARA TELEMETRIA (DISPOSITIVOS RF) ===
            MD: {  // M√≥dulo RF - IoT
                familia: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                frequencia: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                protocolo: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                aplicacao: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                portas: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                acessorio: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                versao: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                }
            },
            RP: {  // Repetidor de Dados
                familia: {
                    allowed: null,
                    default: null
                },
                frequencia: {
                    allowed: null,
                    default: null
                },
                protocolo: {
                    allowed: null,
                    default: null
                },
                aplicacao: {
                    allowed: null,
                    default: null
                },
                portas: {
                    allowed: null,
                    default: null
                },
                acessorio: {
                    allowed: null,
                    default: null
                },
                versao: {
                    allowed: null,
                    default: null
                }
            },
            GW: {  // Gateway
                familia: {
                    allowed: null,
                    default: null
                },
                frequencia: {
                    allowed: null,
                    default: null
                },
                protocolo: {
                    allowed: null,
                    default: null
                },
                aplicacao: {
                    allowed: null,
                    default: null
                },
                portas: {
                    allowed: null,
                    default: null
                },
                acessorio: {
                    allowed: null,
                    default: null
                },
                versao: {
                    allowed: null,
                    default: null
                }
            },
            ST: {  // Dispositivo de Setup (handheld)
                familia: {
                    allowed: null,
                    default: null
                },
                frequencia: {
                    allowed: null,
                    default: null
                },
                protocolo: {
                    allowed: null,
                    default: null
                },
                aplicacao: {
                    allowed: null,
                    default: null
                },
                portas: {
                    allowed: null,
                    default: null
                },
                acessorio: {
                    allowed: null,
                    default: null
                },
                versao: {
                    allowed: null,
                    default: null
                }
            },
            // === FILTROS PARA SENSORES ===
            SH: {  // Sensor de Pulsos tipo HALL
                caracteristica: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                direcao: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                aplicacao: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                },
                marca: {
                    allowed: null,  // null = todas as op√ß√µes
                    default: null
                }
            },
            N: {  // Sensor de N√≠vel
                caracteristica: {
                    allowed: null,
                    default: null
                },
                direcao: {
                    allowed: null,
                    default: null
                },
                aplicacao: {
                    allowed: null,
                    default: null
                },
                marca: {
                    allowed: null,
                    default: null
                }
            },
            P: {  // Sensor de Press√£o
                caracteristica: {
                    allowed: null,
                    default: null
                },
                direcao: {
                    allowed: null,
                    default: null
                },
                aplicacao: {
                    allowed: null,
                    default: null
                },
                marca: {
                    allowed: null,
                    default: null
                }
            }
        };
        
        function loadFilterConfig() {
            const tipoProduto = document.getElementById('filter-tipo-produto').value;
            const contentDiv = document.getElementById('filter-config-content');
            const noSelectionDiv = document.getElementById('filter-no-selection');
            
            if (!tipoProduto) {
                contentDiv.style.display = 'none';
                noSelectionDiv.style.display = 'block';
                return;
            }
            
            contentDiv.style.display = 'block';
            noSelectionDiv.style.display = 'none';
            
            // Carregar configura√ß√£o atual
            const config = filterConfig[tipoProduto];
            
            // Configurar Tipo de Medidor
            loadFilterOptions('tipoMed', dataStore.medidores.tipoMed, config.tipoMed);
            
            // Configurar Tipo de Equipagem
            loadFilterOptions('equipagem', dataStore.medidores.equipagem, config.equipagem);
            
            // Configurar Rela√ß√£o Pulso/Litro
            loadFilterOptions('pulso', dataStore.medidores.pulso, config.pulso);
            
            // Configurar Marca
            loadFilterOptions('marca', dataStore.medidores.marca, config.marca);
            
            // Configurar √Årea de Aplica√ß√£o
            loadFilterOptions('aplicacao', dataStore.medidores.aplicacao, config.aplicacao);
        }
        
        function loadFilterOptions(fieldName, allOptions, currentConfig) {
            const optionsDiv = document.getElementById(`filter-${fieldName}-options`);
            const defaultSelect = document.getElementById(`filter-${fieldName}-default`);
            
            // Limpar conte√∫do anterior
            optionsDiv.innerHTML = '';
            defaultSelect.innerHTML = '<option value="">Nenhum</option>';
            
            // Criar checkboxes para cada op√ß√£o
            allOptions.forEach(option => {
                const isAllowed = currentConfig.allowed === null || currentConfig.allowed.includes(option.codigo);
                
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'display: flex; align-items: center; padding: 10px; background: white; border-radius: 5px; border: 2px solid transparent; transition: all 0.3s ease;';
                itemDiv.onmouseover = function() { this.style.borderColor = 'var(--laager-blue-1)'; };
                itemDiv.onmouseout = function() { this.style.borderColor = 'transparent'; };
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `filter-${fieldName}-${option.codigo}`;
                checkbox.value = option.codigo;
                checkbox.checked = isAllowed;
                checkbox.style.cssText = 'width: 20px; height: 20px; margin-right: 10px; cursor: pointer;';
                checkbox.onchange = () => updateDefaultOptions(fieldName);
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = `${option.descricao} (${option.codigo})`;
                label.style.cssText = 'cursor: pointer; flex: 1; margin: 0;';
                
                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                optionsDiv.appendChild(itemDiv);
                
                // Adicionar ao select de valor padr√£o se estiver permitido
                if (isAllowed) {
                    const optionElem = document.createElement('option');
                    optionElem.value = option.codigo;
                    optionElem.textContent = `${option.descricao} (${option.codigo})`;
                    if (currentConfig.default === option.codigo) {
                        optionElem.selected = true;
                    }
                    defaultSelect.appendChild(optionElem);
                }
            });
        }
        
        function updateDefaultOptions(fieldName) {
            const tipoProduto = document.getElementById('filter-tipo-produto').value;
            const defaultSelect = document.getElementById(`filter-${fieldName}-default`);
            const currentDefault = defaultSelect.value;
            
            // Reconstruir o select de valor padr√£o baseado nos checkboxes marcados
            defaultSelect.innerHTML = '<option value="">Nenhum</option>';
            
            const checkboxes = document.querySelectorAll(`input[id^="filter-${fieldName}-"]:checked`);
            checkboxes.forEach(checkbox => {
                const codigo = checkbox.value;
                let allOptions;
                
                if (fieldName === 'tipoMed') {
                    allOptions = dataStore.medidores.tipoMed;
                } else if (fieldName === 'aplicacao') {
                    allOptions = dataStore.medidores.aplicacao;
                }
                
                const option = allOptions.find(opt => opt.codigo === codigo);
                if (option) {
                    const optionElem = document.createElement('option');
                    optionElem.value = option.codigo;
                    optionElem.textContent = `${option.descricao} (${option.codigo})`;
                    if (currentDefault === option.codigo) {
                        optionElem.selected = true;
                    }
                    defaultSelect.appendChild(optionElem);
                }
            });
        }
        
        function saveFilterConfig() {
            const tipoProduto = document.getElementById('filter-tipo-produto').value;
            if (!tipoProduto) return;
            
            // Salvar configura√ß√£o de Tipo de Medidor
            const tipoMedAllowed = [];
            document.querySelectorAll('input[id^="filter-tipoMed-"]:checked').forEach(cb => {
                tipoMedAllowed.push(cb.value);
            });
            const tipoMedDefault = document.getElementById('filter-tipoMed-default').value || null;
            
            // Salvar configura√ß√£o de Tipo de Equipagem
            const equipagemAllowed = [];
            document.querySelectorAll('input[id^="filter-equipagem-"]:checked').forEach(cb => {
                equipagemAllowed.push(cb.value);
            });
            const equipagemDefault = document.getElementById('filter-equipagem-default').value || null;
            
            // Salvar configura√ß√£o de Rela√ß√£o Pulso/Litro
            const pulsoAllowed = [];
            document.querySelectorAll('input[id^="filter-pulso-"]:checked').forEach(cb => {
                pulsoAllowed.push(cb.value);
            });
            const pulsoDefault = document.getElementById('filter-pulso-default').value || null;
            
            // Salvar configura√ß√£o de Marca
            const marcaAllowed = [];
            document.querySelectorAll('input[id^="filter-marca-"]:checked').forEach(cb => {
                marcaAllowed.push(cb.value);
            });
            const marcaDefault = document.getElementById('filter-marca-default').value || null;
            
            // Salvar configura√ß√£o de √Årea de Aplica√ß√£o
            const aplicacaoAllowed = [];
            document.querySelectorAll('input[id^="filter-aplicacao-"]:checked').forEach(cb => {
                aplicacaoAllowed.push(cb.value);
            });
            const aplicacaoDefault = document.getElementById('filter-aplicacao-default').value || null;
            
            // Atualizar filterConfig
            filterConfig[tipoProduto] = {
                tipoMed: {
                    allowed: tipoMedAllowed.length === dataStore.medidores.tipoMed.length ? null : tipoMedAllowed,
                    default: tipoMedDefault
                },
                equipagem: {
                    allowed: equipagemAllowed.length === dataStore.medidores.equipagem.length ? null : equipagemAllowed,
                    default: equipagemDefault
                },
                pulso: {
                    allowed: pulsoAllowed.length === dataStore.medidores.pulso.length ? null : pulsoAllowed,
                    default: pulsoDefault
                },
                marca: {
                    allowed: marcaAllowed.length === dataStore.medidores.marca.length ? null : marcaAllowed,
                    default: marcaDefault
                },
                aplicacao: {
                    allowed: aplicacaoAllowed.length === dataStore.medidores.aplicacao.length ? null : aplicacaoAllowed,
                    default: aplicacaoDefault
                }
            };
            
            // Salvar no localStorage
            localStorage.setItem('laagerFilterConfig', JSON.stringify(filterConfig));
            
            alert('‚úÖ Configura√ß√£o de filtros salva com sucesso!\n\nAs altera√ß√µes ser√£o aplicadas imediatamente ao selecionar este tipo de produto.');
        }
        
        function resetFilterConfig() {
            const tipoProduto = document.getElementById('filter-tipo-produto').value;
            if (!tipoProduto) return;
            
            if (!confirm('Tem certeza que deseja restaurar a configura√ß√£o padr√£o para este tipo de produto?')) {
                return;
            }
            
            // Restaurar configura√ß√£o padr√£o
            if (tipoProduto === 'HD') {
                filterConfig.HD = {
                    tipoMed: { allowed: ['UJ', 'MJ'], default: null },
                    equipagem: { allowed: null, default: null },
                    pulso: { allowed: null, default: null },
                    marca: { allowed: null, default: null },
                    aplicacao: { allowed: ['AF', 'AQ'], default: null }
                };
            } else if (tipoProduto === 'GS') {
                filterConfig.GS = {
                    tipoMed: { allowed: ['DF', 'VL'], default: 'DF' },
                    equipagem: { allowed: null, default: null },
                    pulso: { allowed: null, default: null },
                    marca: { allowed: null, default: null },
                    aplicacao: { allowed: ['0'], default: '0' }
                };
            } else if (tipoProduto === 'MI') {
                filterConfig.MI = {
                    tipoMed: { allowed: null, default: null },
                    equipagem: { allowed: null, default: null },
                    pulso: { allowed: null, default: null },
                    marca: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null }
                };
            }
            
            // Salvar no localStorage
            localStorage.setItem('laagerFilterConfig', JSON.stringify(filterConfig));
            
            // Recarregar a interface
            loadFilterConfig();
            
            alert('‚úÖ Configura√ß√£o restaurada para o padr√£o!');
        }
        
        // ===== FIM DAS FUN√á√ïES DE CONFIGURA√á√ÉO DE FILTROS DE MEDIDORES =====

        // ===== FUN√á√ïES DE CONFIGURA√á√ÉO DE FILTROS DE TELEMETRIA =====

        function loadFilterConfigTelemetria() {
            const tipoProduto = document.getElementById('filter-tipo-telemetria').value;
            const contentDiv = document.getElementById('filter-config-content-telemetria');
            const noSelectionDiv = document.getElementById('filter-no-selection-telemetria');
            
            if (!tipoProduto) {
                contentDiv.style.display = 'none';
                noSelectionDiv.style.display = 'block';
                return;
            }
            
            contentDiv.style.display = 'block';
            noSelectionDiv.style.display = 'none';
            
            // Carregar configura√ß√£o atual
            const config = filterConfig[tipoProduto];
            
            // Configurar Fam√≠lia
            loadFilterOptionsTelemetria('familia', dataStore.telemetria.familia, config.familia);
            
            // Configurar Frequ√™ncia
            loadFilterOptionsTelemetria('frequencia', dataStore.telemetria.frequencia, config.frequencia);
            
            // Configurar Protocolo
            loadFilterOptionsTelemetria('protocolo', dataStore.telemetria.protocolo, config.protocolo);
            
            // Configurar Aplica√ß√£o
            loadFilterOptionsTelemetria('aplicacao', dataStore.telemetria.aplicacao, config.aplicacao);
            
            // Configurar N√∫mero de Portas
            loadFilterOptionsTelemetria('portas', dataStore.telemetria.portas, config.portas);
            
            // Configurar Tipo de Acess√≥rio/Sensor
            loadFilterOptionsTelemetria('acessorio', dataStore.telemetria.acessorio, config.acessorio);
            
            // Configurar Vers√£o
            loadFilterOptionsTelemetria('versao', dataStore.telemetria.versao, config.versao);
        }
        
        function loadFilterOptionsTelemetria(fieldName, allOptions, currentConfig) {
            const optionsDiv = document.getElementById(`filter-tel-${fieldName}-options`);
            const defaultSelect = document.getElementById(`filter-tel-${fieldName}-default`);
            
            // Limpar conte√∫do anterior
            optionsDiv.innerHTML = '';
            defaultSelect.innerHTML = '<option value="">Nenhum</option>';
            
            // Criar checkboxes para cada op√ß√£o
            allOptions.forEach(option => {
                const isAllowed = currentConfig.allowed === null || currentConfig.allowed.includes(option.codigo);
                
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'display: flex; align-items: center; padding: 10px; background: white; border-radius: 5px; border: 2px solid transparent; transition: all 0.3s ease;';
                itemDiv.onmouseover = function() { this.style.borderColor = 'var(--laager-blue-1)'; };
                itemDiv.onmouseout = function() { this.style.borderColor = 'transparent'; };
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `filter-tel-${fieldName}-${option.codigo}`;
                checkbox.value = option.codigo;
                checkbox.checked = isAllowed;
                checkbox.style.cssText = 'width: 20px; height: 20px; margin-right: 10px; cursor: pointer;';
                checkbox.onchange = () => updateDefaultOptionsTelemetria(fieldName);
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = `${option.descricao} (${option.codigo})`;
                label.style.cssText = 'cursor: pointer; flex: 1; margin: 0;';
                
                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                optionsDiv.appendChild(itemDiv);
                
                // Adicionar ao select de valor padr√£o se estiver permitido
                if (isAllowed) {
                    const optionElem = document.createElement('option');
                    optionElem.value = option.codigo;
                    optionElem.textContent = `${option.descricao} (${option.codigo})`;
                    if (currentConfig.default === option.codigo) {
                        optionElem.selected = true;
                    }
                    defaultSelect.appendChild(optionElem);
                }
            });
        }
        
        function updateDefaultOptionsTelemetria(fieldName) {
            const tipoProduto = document.getElementById('filter-tipo-telemetria').value;
            const defaultSelect = document.getElementById(`filter-tel-${fieldName}-default`);
            const currentDefault = defaultSelect.value;
            
            // Reconstruir o select de valor padr√£o baseado nos checkboxes marcados
            defaultSelect.innerHTML = '<option value="">Nenhum</option>';
            
            const checkboxes = document.querySelectorAll(`input[id^="filter-tel-${fieldName}-"]:checked`);
            checkboxes.forEach(checkbox => {
                const codigo = checkbox.value;
                const allOptions = dataStore.telemetria[fieldName];
                
                const option = allOptions.find(opt => opt.codigo === codigo);
                if (option) {
                    const optionElem = document.createElement('option');
                    optionElem.value = option.codigo;
                    optionElem.textContent = `${option.descricao} (${option.codigo})`;
                    if (currentDefault === option.codigo) {
                        optionElem.selected = true;
                    }
                    defaultSelect.appendChild(optionElem);
                }
            });
        }
        
        function saveFilterConfigTelemetria() {
            const tipoProduto = document.getElementById('filter-tipo-telemetria').value;
            if (!tipoProduto) return;
            
            // Salvar configura√ß√£o de Fam√≠lia
            const familiaAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-familia-"]:checked').forEach(cb => {
                familiaAllowed.push(cb.value);
            });
            const familiaDefault = document.getElementById('filter-tel-familia-default').value || null;
            
            // Salvar configura√ß√£o de Frequ√™ncia
            const frequenciaAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-frequencia-"]:checked').forEach(cb => {
                frequenciaAllowed.push(cb.value);
            });
            const frequenciaDefault = document.getElementById('filter-tel-frequencia-default').value || null;
            
            // Salvar configura√ß√£o de Protocolo
            const protocoloAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-protocolo-"]:checked').forEach(cb => {
                protocoloAllowed.push(cb.value);
            });
            const protocoloDefault = document.getElementById('filter-tel-protocolo-default').value || null;
            
            // Salvar configura√ß√£o de Aplica√ß√£o
            const aplicacaoAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-aplicacao-"]:checked').forEach(cb => {
                aplicacaoAllowed.push(cb.value);
            });
            const aplicacaoDefault = document.getElementById('filter-tel-aplicacao-default').value || null;
            
            // Salvar configura√ß√£o de N√∫mero de Portas
            const portasAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-portas-"]:checked').forEach(cb => {
                portasAllowed.push(cb.value);
            });
            const portasDefault = document.getElementById('filter-tel-portas-default').value || null;
            
            // Salvar configura√ß√£o de Tipo de Acess√≥rio/Sensor
            const acessorioAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-acessorio-"]:checked').forEach(cb => {
                acessorioAllowed.push(cb.value);
            });
            const acessorioDefault = document.getElementById('filter-tel-acessorio-default').value || null;
            
            // Salvar configura√ß√£o de Vers√£o
            const versaoAllowed = [];
            document.querySelectorAll('input[id^="filter-tel-versao-"]:checked').forEach(cb => {
                versaoAllowed.push(cb.value);
            });
            const versaoDefault = document.getElementById('filter-tel-versao-default').value || null;
            
            // Atualizar filterConfig
            filterConfig[tipoProduto] = {
                familia: {
                    allowed: familiaAllowed.length === dataStore.telemetria.familia.length ? null : familiaAllowed,
                    default: familiaDefault
                },
                frequencia: {
                    allowed: frequenciaAllowed.length === dataStore.telemetria.frequencia.length ? null : frequenciaAllowed,
                    default: frequenciaDefault
                },
                protocolo: {
                    allowed: protocoloAllowed.length === dataStore.telemetria.protocolo.length ? null : protocoloAllowed,
                    default: protocoloDefault
                },
                aplicacao: {
                    allowed: aplicacaoAllowed.length === dataStore.telemetria.aplicacao.length ? null : aplicacaoAllowed,
                    default: aplicacaoDefault
                },
                portas: {
                    allowed: portasAllowed.length === dataStore.telemetria.portas.length ? null : portasAllowed,
                    default: portasDefault
                },
                acessorio: {
                    allowed: acessorioAllowed.length === dataStore.telemetria.acessorio.length ? null : acessorioAllowed,
                    default: acessorioDefault
                },
                versao: {
                    allowed: versaoAllowed.length === dataStore.telemetria.versao.length ? null : versaoAllowed,
                    default: versaoDefault
                }
            };
            
            // Salvar no localStorage
            localStorage.setItem('laagerFilterConfig', JSON.stringify(filterConfig));
            
            alert('‚úÖ Configura√ß√£o de filtros de telemetria salva com sucesso!\n\nAs altera√ß√µes ser√£o aplicadas imediatamente ao selecionar este tipo de produto.');
        }
        
        function resetFilterConfigTelemetria() {
            const tipoProduto = document.getElementById('filter-tipo-telemetria').value;
            if (!tipoProduto) return;
            
            if (!confirm('Tem certeza que deseja restaurar a configura√ß√£o padr√£o para este tipo de produto de telemetria?')) {
                return;
            }
            
            // Restaurar configura√ß√£o padr√£o baseada no tipo
            if (tipoProduto === 'MD') {
                filterConfig.MD = {
                    familia: { allowed: null, default: null },
                    frequencia: { allowed: null, default: null },
                    protocolo: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    portas: { allowed: null, default: null },
                    acessorio: { allowed: null, default: null },
                    versao: { allowed: null, default: null }
                };
            } else if (tipoProduto === 'RP') {
                filterConfig.RP = {
                    familia: { allowed: null, default: null },
                    frequencia: { allowed: null, default: null },
                    protocolo: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    portas: { allowed: null, default: null },
                    acessorio: { allowed: null, default: null },
                    versao: { allowed: null, default: null }
                };
            } else if (tipoProduto === 'GW') {
                filterConfig.GW = {
                    familia: { allowed: null, default: null },
                    frequencia: { allowed: null, default: null },
                    protocolo: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    portas: { allowed: null, default: null },
                    acessorio: { allowed: null, default: null },
                    versao: { allowed: null, default: null }
                };
            } else if (tipoProduto === 'ST') {
                filterConfig.ST = {
                    familia: { allowed: null, default: null },
                    frequencia: { allowed: null, default: null },
                    protocolo: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    portas: { allowed: null, default: null },
                    acessorio: { allowed: null, default: null },
                    versao: { allowed: null, default: null }
                };
            }
            
            // Salvar no localStorage
            localStorage.setItem('laagerFilterConfig', JSON.stringify(filterConfig));
            
            // Recarregar a interface
            loadFilterConfigTelemetria();
            
            alert('‚úÖ Configura√ß√£o de telemetria restaurada para o padr√£o!');
        }

        // ===== FIM DAS FUN√á√ïES DE CONFIGURA√á√ÉO DE FILTROS DE TELEMETRIA =====

        // ===== FUN√á√ïES DE CONFIGURA√á√ÉO DE FILTROS DE SENSORES =====
        
        function loadFilterConfigSensores() {
            const tipoSensor = document.getElementById('filter-tipo-sensor').value;
            const content = document.getElementById('filter-config-content-sensores');
            const noSelection = document.getElementById('filter-no-selection-sensores');
            
            if (!tipoSensor) {
                content.style.display = 'none';
                noSelection.style.display = 'block';
                return;
            }
            
            content.style.display = 'block';
            noSelection.style.display = 'none';
            
            // Carregar configura√ß√£o do localStorage
            const savedConfig = localStorage.getItem('laagerFilterConfig');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                if (config[tipoSensor]) {
                    Object.assign(filterConfig, config);
                }
            }
            
            // Carregar op√ß√µes para cada campo
            loadFilterOptionsSensores('caracteristica', tipoSensor);
            loadFilterOptionsSensores('direcao', tipoSensor);
            loadFilterOptionsSensores('aplicacao', tipoSensor);
            loadFilterOptionsSensores('marca', tipoSensor);
        }
        
        function loadFilterOptionsSensores(campo, tipoSensor) {
            const container = document.getElementById(`filter-sens-${campo}-options`);
            const defaultSelect = document.getElementById(`filter-sens-${campo}-default`);
            
            container.innerHTML = '';
            defaultSelect.innerHTML = '<option value="">Nenhum</option>';
            
            const opcoes = dataStore.sensores[campo] || [];
            const config = filterConfig[tipoSensor] || {};
            const campoConfig = config[campo] || { allowed: null, default: null };
            
            opcoes.forEach((opcao, index) => {
                const isChecked = campoConfig.allowed === null || campoConfig.allowed.includes(opcao.codigo);
                
                const div = document.createElement('div');
                div.style.cssText = 'display: flex; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 5px; border: 2px solid #e0e0e0; transition: all 0.2s ease;';
                div.onmouseover = function() { this.style.borderColor = '#00B1FF'; this.style.boxShadow = '0 2px 8px rgba(0,177,255,0.2)'; };
                div.onmouseout = function() { this.style.borderColor = '#e0e0e0'; this.style.boxShadow = 'none'; };
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = isChecked;
                checkbox.id = `filter-sens-${campo}-${index}`;
                checkbox.style.cssText = 'width: 20px; height: 20px; margin-right: 10px; cursor: pointer;';
                checkbox.onchange = () => updateDefaultOptionsSensores(campo, tipoSensor);
                
                const label = document.createElement('label');
                label.htmlFor = `filter-sens-${campo}-${index}`;
                label.textContent = `${opcao.descricao} (${opcao.codigo})`;
                label.style.cssText = 'cursor: pointer; flex: 1; user-select: none;';
                
                div.appendChild(checkbox);
                div.appendChild(label);
                container.appendChild(div);
                
                // Adicionar ao select de valor padr√£o se estiver marcado
                if (isChecked) {
                    const option = document.createElement('option');
                    option.value = opcao.codigo;
                    option.textContent = `${opcao.descricao} (${opcao.codigo})`;
                    if (campoConfig.default === opcao.codigo) {
                        option.selected = true;
                    }
                    defaultSelect.appendChild(option);
                }
            });
        }
        
        function updateDefaultOptionsSensores(campo, tipoSensor) {
            const container = document.getElementById(`filter-sens-${campo}-options`);
            const defaultSelect = document.getElementById(`filter-sens-${campo}-default`);
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            
            const currentDefault = defaultSelect.value;
            defaultSelect.innerHTML = '<option value="">Nenhum</option>';
            
            const opcoes = dataStore.sensores[campo] || [];
            checkboxes.forEach((checkbox, index) => {
                if (checkbox.checked && opcoes[index]) {
                    const option = document.createElement('option');
                    option.value = opcoes[index].codigo;
                    option.textContent = `${opcoes[index].descricao} (${opcoes[index].codigo})`;
                    if (currentDefault === opcoes[index].codigo) {
                        option.selected = true;
                    }
                    defaultSelect.appendChild(option);
                }
            });
        }
        
        function saveFilterConfigSensores() {
            const tipoSensor = document.getElementById('filter-tipo-sensor').value;
            
            if (!tipoSensor) {
                alert('‚ö†Ô∏è Selecione um tipo de sensor primeiro!');
                return;
            }
            
            // Criar configura√ß√£o para o tipo de sensor
            filterConfig[tipoSensor] = {};
            
            const campos = ['caracteristica', 'direcao', 'aplicacao', 'marca'];
            
            campos.forEach(campo => {
                const container = document.getElementById(`filter-sens-${campo}-options`);
                const defaultSelect = document.getElementById(`filter-sens-${campo}-default`);
                const checkboxes = container.querySelectorAll('input[type="checkbox"]');
                
                const allowed = [];
                const opcoes = dataStore.sensores[campo] || [];
                
                checkboxes.forEach((checkbox, index) => {
                    if (checkbox.checked && opcoes[index]) {
                        allowed.push(opcoes[index].codigo);
                    }
                });
                
                filterConfig[tipoSensor][campo] = {
                    allowed: allowed.length === opcoes.length ? null : allowed,
                    default: defaultSelect.value || null
                };
            });
            
            // Salvar no localStorage
            localStorage.setItem('laagerFilterConfig', JSON.stringify(filterConfig));
            
            alert('‚úÖ Configura√ß√£o de sensores salva com sucesso!');
        }
        
        function resetFilterConfigSensores() {
            const tipoSensor = document.getElementById('filter-tipo-sensor').value;
            
            if (!tipoSensor) {
                alert('‚ö†Ô∏è Selecione um tipo de sensor primeiro!');
                return;
            }
            
            if (!confirm('‚ö†Ô∏è Tem certeza que deseja restaurar a configura√ß√£o padr√£o para este tipo de sensor?\n\nIsso ir√°:\n- Permitir todas as op√ß√µes em todos os campos\n- Remover valores padr√£o configurados')) {
                return;
            }
            
            // Restaurar configura√ß√£o padr√£o (todas op√ß√µes permitidas, sem valor padr√£o)
            if (tipoSensor === 'SH') {
                filterConfig.SH = {
                    caracteristica: { allowed: null, default: null },
                    direcao: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    marca: { allowed: null, default: null }
                };
            } else if (tipoSensor === 'N') {
                filterConfig.N = {
                    caracteristica: { allowed: null, default: null },
                    direcao: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    marca: { allowed: null, default: null }
                };
            } else if (tipoSensor === 'P') {
                filterConfig.P = {
                    caracteristica: { allowed: null, default: null },
                    direcao: { allowed: null, default: null },
                    aplicacao: { allowed: null, default: null },
                    marca: { allowed: null, default: null }
                };
            }
            
            // Salvar no localStorage
            localStorage.setItem('laagerFilterConfig', JSON.stringify(filterConfig));
            
            // Recarregar a interface
            loadFilterConfigSensores();
            
            alert('‚úÖ Configura√ß√£o de sensores restaurada para o padr√£o!');
        }

        // ===== FIM DAS FUN√á√ïES DE CONFIGURA√á√ÉO DE FILTROS DE SENSORES =====

        // ===== FUN√á√ïES DE EXPORTA√á√ÉO E IMPORTA√á√ÉO CSV =====
        
        function exportToCSV() {
            const codigo = document.getElementById('footer-codigo').textContent;
            const descricao = document.getElementById('footer-descricao').textContent;
            
            if (!codigo || codigo === '-') {
                alert('‚ö†Ô∏è Nenhum c√≥digo gerado para exportar!');
                return;
            }
            
            // Criar conte√∫do CSV
            const csvContent = 'C√≥digo,Descri√ß√£o\n' + `"${codigo}","${descricao}"`;
            
            // Criar blob e fazer download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `codigo_laager_${codigo}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‚úÖ Arquivo CSV exportado com sucesso!');
        }
        
        function importFromCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const csvData = event.target.result;
                        const lines = csvData.split('\n');
                        
                        if (lines.length < 2) {
                            alert('‚ö†Ô∏è Arquivo CSV vazio ou inv√°lido!');
                            return;
                        }
                        
                        // Pular cabe√ßalho e processar primeira linha de dados
                        const dataLine = lines[1].trim();
                        if (!dataLine) {
                            alert('‚ö†Ô∏è Nenhum dado encontrado no arquivo CSV!');
                            return;
                        }
                        
                        // Parse da linha CSV (considerando aspas)
                        const matches = dataLine.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                        if (!matches || matches.length < 2) {
                            alert('‚ö†Ô∏è Formato de CSV inv√°lido!');
                            return;
                        }
                        
                        const codigo = matches[0].replace(/"/g, '').trim();
                        const descricao = matches[1].replace(/"/g, '').trim();
                        
                        // Atualizar rodap√©
                        document.getElementById('footer-codigo').textContent = codigo;
                        document.getElementById('footer-descricao').textContent = descricao;
                        
                        alert(`‚úÖ C√≥digo importado com sucesso!\n\nC√≥digo: ${codigo}\nDescri√ß√£o: ${descricao}`);
                        
                    } catch (error) {
                        console.error('Erro ao importar CSV:', error);
                        alert('‚ùå Erro ao processar arquivo CSV!');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // Atualizar rodap√© em tempo real
        function updateFooterDisplay() {
            const codigoElement = document.getElementById('footer-codigo');
            const descricaoElement = document.getElementById('footer-descricao');
            
            if (codigoElement && descricaoElement) {
                const resultCodigo = document.getElementById('result-codigo');
                const resultDescricao = document.getElementById('result-descricao');
                
                if (resultCodigo && resultDescricao) {
                    const codigo = resultCodigo.textContent.trim();
                    const descricao = resultDescricao.textContent.trim();
                    
                    codigoElement.textContent = codigo || '-';
                    descricaoElement.textContent = descricao || '-';
                }
            }
        }
        
        // ===== FIM DAS FUN√á√ïES DE EXPORTA√á√ÉO E IMPORTA√á√ÉO CSV =====

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdminModal();
            }
        }

        // Inicializar ao carregar a p√°gina
        window.onload = function() {
            loadFromStorage();
            
            // Carregar filterConfig do localStorage e fazer merge com configura√ß√£o padr√£o
            const savedFilters = localStorage.getItem('laagerFilterConfig');
            if (savedFilters) {
                try {
                    const saved = JSON.parse(savedFilters);
                    // Fazer merge profundo: usar configura√ß√£o padr√£o como base
                    Object.keys(filterConfig).forEach(tipo => {
                        if (saved[tipo]) {
                            // Para cada campo na configura√ß√£o padr√£o
                            Object.keys(filterConfig[tipo]).forEach(campo => {
                                // Se existe no saved, sobrescrever
                                if (saved[tipo][campo] !== undefined) {
                                    filterConfig[tipo][campo] = saved[tipo][campo];
                                }
                                // Se n√£o existe no saved, manter o padr√£o (j√° est√° em filterConfig)
                            });
                        }
                    });
                } catch (e) {
                    console.error('Erro ao carregar filtros:', e);
                }
            }
            
            initializeForms();
            updateFooterDisplay();
            checkAndHideWarning(); // Verificar e ocultar banner de aviso ao carregar a p√°gina
            
            // Ativar modo escuro por padr√£o
            document.body.classList.add('dark-mode');
            const themeBtn = document.getElementById('theme-toggle-btn');
            if (themeBtn) {
                themeBtn.textContent = 'üåô';
                themeBtn.title = 'Modo Escuro Ativo';
            }
        };
    </script>

    <!-- Rodap√© fixo com c√≥digo e descri√ß√£o -->
    <div class="footer-display">
        <div class="footer-content">
            <div class="footer-field">
                <label>üìã C√ìDIGO</label>
                <div class="footer-field-value" id="footer-codigo">-</div>
            </div>
            <div class="footer-field">
                <label>üìù DESCRI√á√ÉO</label>
                <div class="footer-field-value" id="footer-descricao">-</div>
            </div>
        </div>
    </div>

</body>
</html>
